<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>萌芽AI - 完整iPad演示</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="mengya-common.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: 
                radial-gradient(circle at 20% 30%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #1e293b 0%, #334155 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px 40px;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            overflow: hidden;
        }
        
        /* iPad Pro 11寸设备模拟 */
        .ipad-pro-device {
            width: 900px;
            height: 650px;
            background: 
                linear-gradient(145deg, #2c2c2e 0%, #1c1c1e 100%);
            border-radius: 25px;
            padding: 12px;
            box-shadow: 
                0 0 0 2px #404040,
                0 0 0 8px #2c2c2e,
                0 0 0 12px #1a1a1a,
                0 25px 80px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            transform: perspective(1200px) rotateX(8deg) rotateY(-3deg);
            animation: deviceHover 8s ease-in-out infinite;
        }
        
        @keyframes deviceHover {
            0%, 100% { 
                transform: perspective(1200px) rotateX(8deg) rotateY(-3deg) translateY(0px);
                box-shadow: 
                    0 0 0 2px #404040,
                    0 0 0 8px #2c2c2e,
                    0 0 0 12px #1a1a1a,
                    0 25px 80px rgba(0, 0, 0, 0.6),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }
            50% { 
                transform: perspective(1200px) rotateX(8deg) rotateY(-3deg) translateY(-12px);
                box-shadow: 
                    0 0 0 2px #404040,
                    0 0 0 8px #2c2c2e,
                    0 0 0 12px #1a1a1a,
                    0 35px 100px rgba(0, 0, 0, 0.8),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }
        }
        
        /* Face ID传感器 */
        .face-id-sensor {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 6px;
            background: #1a1a1a;
            border-radius: 3px;
        }
        
        /* iPad屏幕 */
        .ipad-screen {
            width: 100%;
            height: 100%;
            background: #000;
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.3);
        }
        
        /* 屏幕反射效果 */
        .screen-reflection {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                transparent 30%, 
                transparent 70%, 
                rgba(255, 255, 255, 0.05) 100%);
            pointer-events: none;
            z-index: 1000;
        }
        
        /* iOS 17风格状态栏 */
        .ios-status-bar {
            height: 35px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 25px;
            font-size: 15px;
            font-weight: 600;
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .signal-strength {
            display: flex;
            gap: 2px;
        }
        
        .signal-bar {
            width: 3px;
            height: 12px;
            background: white;
            border-radius: 1px;
        }
        
        .signal-bar:nth-child(2) { height: 10px; }
        .signal-bar:nth-child(3) { height: 8px; }
        .signal-bar:nth-child(4) { height: 6px; }
        
        .battery-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .battery-icon {
            width: 24px;
            height: 12px;
            border: 1px solid white;
            border-radius: 2px;
            position: relative;
        }
        
        .battery-fill {
            width: 85%;
            height: 100%;
            background: #34d399;
            border-radius: 1px;
        }
        
        .battery-tip {
            width: 2px;
            height: 6px;
            background: white;
            border-radius: 0 1px 1px 0;
            position: absolute;
            right: -3px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        /* 萌芽AI App界面 */
        .mengya-app {
            width: 100%;
            height: calc(100% - 35px);
            background: #f2f2f7;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* App导航栏 */
        .app-navigation {
            height: 70px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 0 20px;
        }
        
        .app-logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-logo {
            font-size: 32px;
            /* 移除旋转动画，改为轻微浮动效果 */
            animation: logoFloat 4s ease-in-out infinite;
        }
        
        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }
        
        .app-title {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .app-subtitle {
            font-size: 12px;
            color: #8e8e93;
            font-weight: 500;
        }
        
        /* 主内容区域 */
        .app-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        /* 欢迎横幅 */
        .welcome-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .welcome-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 50%);
            animation: bannerGlow 8s ease-in-out infinite;
        }
        
        @keyframes bannerGlow {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
        }
        
        .welcome-content {
            position: relative;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .welcome-text {
            flex: 1;
        }
        
        .welcome-greeting {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .welcome-message {
            font-size: 14px;
            opacity: 0.9;
            line-height: 1.4;
        }
        
        .welcome-avatar {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            animation: welcomeFloat 3s ease-in-out infinite;
        }
        
        @keyframes welcomeFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }
        
        /* 功能卡片网格 */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .feature-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .feature-card:active {
            transform: translateY(-2px);
        }
        
        .feature-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .feature-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .feature-title {
            font-size: 16px;
            font-weight: 700;
            color: #1d1d1f;
        }
        
        .feature-subtitle {
            font-size: 13px;
            color: #8e8e93;
            margin-bottom: 12px;
        }
        
        .feature-content {
            font-size: 14px;
            color: #3a3a3c;
            line-height: 1.4;
        }
        
        .feature-badge {
            background: #ff3b30;
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 8px;
        }
        
        /* 能力训练卡片样式 */
        .training-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .training-card .feature-icon {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* 虚拟伙伴卡片样式 */
        .partner-card {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            color: white;
        }
        
        .partner-card .feature-icon {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* AI助教卡片样式 */
        .ai-card {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .ai-card .feature-icon {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* 首页样式定义 */
        .today-learning {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);
        }
        
        .learning-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .learning-title {
            font-size: 18px;
            font-weight: 700;
        }
        
        .learning-streak {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .learning-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }
        
        .stat-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: 12px;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .ability-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .ability-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .ability-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        
        .ability-item.completed {
            border-color: #34d399;
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        }
        
        .ability-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .ability-name {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .ability-progress {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .ability-item.completed .ability-progress {
            color: #059669;
            font-weight: 600;
        }
        
        /* 故事墙卡片样式 */
        .story-card {
            background: linear-gradient(135deg, #ec4899 0%, #be185d 100%);
            color: white;
        }
        
        .story-card .feature-icon {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* 底部Tab Bar */
        .tab-bar {
            height: 90px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 30px;
        }
        
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            padding: 8px 20px;
            border-radius: 12px;
            transition: all 0.2s ease;
            color: #8e8e93;
            position: relative;
        }
        
        .tab-item.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .tab-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        .tab-icon {
            font-size: 26px;
            margin-bottom: 2px;
        }
        
        .tab-label {
            font-size: 11px;
            font-weight: 600;
        }
        
        .notification-dot {
            position: absolute;
            top: 8px;
            right: 15px;
            width: 8px;
            height: 8px;
            background: #ff3b30;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        /* Home指示器 */
        .home-indicator {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }
        
        /* 设备环境光 */
        .device-glow {
            position: absolute;
            top: -100px;
            left: -100px;
            width: calc(100% + 200px);
            height: calc(100% + 200px);
            background: 
                radial-gradient(circle at 40% 40%, rgba(102, 126, 234, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 60% 60%, rgba(236, 72, 153, 0.15) 0%, transparent 50%);
            animation: glowShift 12s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes glowShift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(20px, -20px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }
        
        /* 启动动画 */
        .startup-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 100;
            transition: opacity 1.5s ease;
        }
        
        .startup-animation.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .startup-logo {
            font-size: 80px;
            margin-bottom: 24px;
            animation: startupPulse 2s ease-in-out infinite;
        }
        
        @keyframes startupPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .startup-text {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 32px;
            text-align: center;
        }
        
        .startup-progress {
            width: 240px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .startup-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
            width: 0%;
            animation: startupProgress 4s ease-out forwards;
        }
        
        @keyframes startupProgress {
            to { width: 100%; }
        }
        
        /* 内容加载动画 */
        .content-fade-in {
            opacity: 0;
            transform: translateY(20px);
            animation: contentFadeIn 0.8s ease forwards;
        }
        
        @keyframes contentFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 3D设备阴影 */
        .device-shadow {
            position: absolute;
            bottom: -120px;
            left: 50%;
            transform: translateX(-50%) perspective(1000px) rotateX(90deg);
            width: 80%;
            height: 120px;
            background: 
                radial-gradient(ellipse, rgba(0, 0, 0, 0.3) 0%, transparent 70%);
            filter: blur(20px);
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <!-- 设备环境光 -->
    <div class="device-glow"></div>
    
    <!-- iPad Pro设备 -->
    <div class="ipad-pro-device">
        <!-- Face ID传感器 -->
        <div class="face-id-sensor"></div>
        
        <!-- iPad屏幕 -->
        <div class="ipad-screen">
            <!-- 屏幕反射效果 -->
            <div class="screen-reflection"></div>
            
            <!-- 启动动画 -->
            <div class="startup-animation" id="startupAnimation">
                <div class="startup-logo">🌱</div>
                <div class="startup-text">
                    萌芽AI<br>
                    <span style="font-size: 14px; opacity: 0.8;">智能儿童学习平台</span>
                </div>
                <div class="startup-progress">
                    <div class="startup-progress-fill"></div>
                </div>
            </div>
            
            <!-- iOS状态栏 -->
            <div class="ios-status-bar">
                <div class="status-left">
                    <span id="currentTime">14:32</span>
                    <span style="font-size: 12px; opacity: 0.8;">周日</span>
                </div>
                <div class="status-right">
                    <div class="signal-strength">
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                    </div>
                    <i class="fas fa-wifi" style="font-size: 14px;"></i>
                    <div class="battery-indicator">
                        <span style="font-size: 12px;">87%</span>
                        <div class="battery-icon">
                            <div class="battery-fill"></div>
                            <div class="battery-tip"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 萌芽AI App -->
            <div class="mengya-app">
                <!-- App导航 -->
                <div class="app-navigation">
                    <div class="app-logo-section">
                        <div class="app-logo">🌱</div>
                        <div>
                            <div class="app-title">萌芽AI</div>
                            <div class="app-subtitle">智能学习伙伴</div>
                        </div>
                    </div>
                </div>
                
                <!-- App内容 -->
                <div class="app-content" id="appContent">
                    <!-- 欢迎横幅 -->
                    <div class="welcome-banner content-fade-in" style="animation-delay: 0.2s;">
                        <div class="welcome-content">
                            <div class="welcome-text">
                                <div class="welcome-greeting">下午好，小明！</div>
                                <div class="welcome-message">今天是学习的第5天，让我们继续精彩的学习之旅吧！</div>
                            </div>
                            <div class="welcome-avatar">👦</div>
                        </div>
                    </div>
                    
                    <!-- 功能卡片网格 -->
                    <div class="feature-grid">
                        <!-- 能力训练 -->
                        <div class="feature-card training-card content-fade-in" style="animation-delay: 0.4s;" onclick="openTrainingCenter()">
                            <div class="feature-header">
                                <div class="feature-icon">🎯</div>
                                <div class="feature-badge">NEW</div>
                            </div>
                            <div class="feature-title">能力训练中心</div>
                            <div class="feature-subtitle">五大核心能力提升</div>
                            <div class="feature-content">
                                <div style="margin-bottom: 12px;">
                                    <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">今日进度</div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span>表达力 💬</span>
                                        <span>65/100</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span>创造力 🎨</span>
                                        <span>80/100 ✓</span>
                                    </div>
                                </div>
                                <button style="background: rgba(255, 255, 255, 0.2); color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600; width: 100%;">
                                    开始训练 →
                                </button>
                            </div>
                        </div>
                        
                        <!-- 虚拟伙伴 -->
                        <div class="feature-card partner-card content-fade-in" style="animation-delay: 0.6s;" onclick="openPartnerCenter()">
                            <div class="feature-header">
                                <div class="feature-icon">🌱</div>
                                <div style="font-size: 12px; opacity: 0.9;">Lv.4</div>
                            </div>
                            <div class="feature-title">我的伙伴</div>
                            <div class="feature-subtitle">小芽芽陪你成长</div>
                            <div class="feature-content">
                                <div style="text-align: center; margin: 16px 0;">
                                    <div style="font-size: 32px; margin-bottom: 8px;">🌳</div>
                                    <div style="font-size: 14px; opacity: 0.9;">开心愉悦 • 想要学习</div>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="event.stopPropagation(); feedPartnerQuick()" style="flex: 1; background: rgba(255, 255, 255, 0.2); color: white; border: none; padding: 6px; border-radius: 6px; font-size: 11px;">喂食</button>
                                    <button onclick="event.stopPropagation(); playWithPartnerQuick()" style="flex: 1; background: rgba(255, 255, 255, 0.2); color: white; border: none; padding: 6px; border-radius: 6px; font-size: 11px;">游戏</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI助教 -->
                        <div class="feature-card ai-card content-fade-in" style="animation-delay: 0.8s;" onclick="openAIAssistant()">
                            <div class="feature-header">
                                <div class="feature-icon">🤖</div>
                                <div style="display: flex; gap: 4px;">
                                    <div style="background: #ff3b30; color: white; padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: bold;">AI驱动</div>
                                    <div class="feature-badge">3</div>
                                </div>
                            </div>
                            <div class="feature-title">AI助教小萌</div>
                            <div class="feature-subtitle">基于学科内容的智能指导</div>
                            <div class="feature-content">
                                <div style="background: rgba(255, 255, 255, 0.2); padding: 12px; border-radius: 8px; margin-bottom: 12px; font-size: 13px;">
                                    "基于你的能力分析，我推荐语文+数学融合的逻辑表达训练"
                                </div>
                                <button style="background: rgba(255, 255, 255, 0.2); color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600; width: 100%;">
                                    获取AI指导 →
                                </button>
                            </div>
                        </div>
                        
                        <!-- 故事墙 -->
                        <div class="feature-card story-card content-fade-in" style="animation-delay: 1.0s;" onclick="openStoryWall()">
                            <div class="feature-header">
                                <div class="feature-icon">📚</div>
                                <div style="font-size: 12px; opacity: 0.9;">热门</div>
                            </div>
                            <div class="feature-title">故事创作墙</div>
                            <div class="feature-subtitle">分享你的创意作品</div>
                            <div class="feature-content">
                                <div style="margin-bottom: 12px;">
                                    <div style="font-size: 13px; opacity: 0.9; margin-bottom: 6px;">📖 《小兔子的冒险》</div>
                                    <div style="font-size: 12px; opacity: 0.8;">❤️ 28个赞 • 🔥 热门作品</div>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="event.stopPropagation(); likeStory()" style="flex: 1; background: rgba(255, 255, 255, 0.2); color: white; border: none; padding: 6px; border-radius: 6px; font-size: 11px;">点赞</button>
                                    <button onclick="event.stopPropagation(); shareStory()" style="flex: 1; background: rgba(255, 255, 255, 0.2); color: white; border: none; padding: 6px; border-radius: 6px; font-size: 11px;">分享</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 今日成就 -->
                    <div class="ios-card content-fade-in" style="animation-delay: 1.2s; background: white; border-radius: 16px; padding: 20px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 20px;">🏆</span>
                                <span style="font-size: 16px; font-weight: 700; color: #1d1d1f;">今日成就</span>
                            </div>
                            <span style="color: #667eea; font-size: 14px; font-weight: 500;">查看全部</span>
                        </div>
                        
                        <div style="display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px;">
                            <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border-radius: 12px; padding: 16px; text-align: center; min-width: 100px; position: relative;">
                                <div style="position: absolute; top: -4px; right: -4px; background: #ff3b30; color: white; font-size: 8px; padding: 2px 4px; border-radius: 4px; font-weight: bold;">NEW</div>
                                <div style="font-size: 24px; margin-bottom: 8px;">🎨</div>
                                <div style="font-size: 12px; font-weight: 600;">创意大师</div>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #34d399, #10b981); color: white; border-radius: 12px; padding: 16px; text-align: center; min-width: 100px;">
                                <div style="font-size: 24px; margin-bottom: 8px;">💬</div>
                                <div style="font-size: 12px; font-weight: 600;">表达专家</div>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 12px; padding: 16px; text-align: center; min-width: 100px;">
                                <div style="font-size: 24px; margin-bottom: 8px;">🔥</div>
                                <div style="font-size: 12px; font-weight: 600;">坚持冠军</div>
                            </div>
                            
                            <div style="background: #f2f2f7; border: 2px dashed #d1d5db; border-radius: 12px; padding: 16px; text-align: center; min-width: 100px; color: #8e8e93;">
                                <div style="font-size: 24px; margin-bottom: 8px;">🔒</div>
                                <div style="font-size: 12px; font-weight: 600;">待解锁</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Bar -->
                <div class="tab-bar">
                    <div class="tab-item active" onclick="switchTab('home')">
                        <div class="tab-icon">🏠</div>
                        <div class="tab-label">首页</div>
                    </div>
                    
                    <div class="tab-item" onclick="switchTab('learning')">
                        <div class="tab-icon">🎯</div>
                        <div class="tab-label">训练</div>
                    </div>
                    
                    <div class="tab-item" onclick="switchTab('ai')">
                        <div class="tab-icon">🤖</div>
                        <div class="tab-label">AI助教</div>
                        <div class="notification-dot"></div>
                    </div>
                    
                    <div class="tab-item" onclick="switchTab('story')">
                        <div class="tab-icon">📚</div>
                        <div class="tab-label">故事</div>
                    </div>
                    
                    <div class="tab-item" onclick="switchTab('profile')">
                        <div class="tab-icon">👤</div>
                        <div class="tab-label">我的</div>
                    </div>
                    
                    <div class="tab-item" onclick="switchTab('parent')">
                        <div class="tab-icon">👨‍👩‍👧‍👦</div>
                        <div class="tab-label">家长端</div>
                    </div>
                </div>
            </div>
            
            <!-- Home指示器 -->
            <div class="home-indicator"></div>
        </div>
        
        <!-- 设备阴影 -->
        <div class="device-shadow"></div>
    </div>

    <script>
        // 页面启动
        document.addEventListener('DOMContentLoaded', function() {
            startApp();
            updateTime();
            setInterval(updateTime, 1000);
        });
        
        // 启动应用
        function startApp() {
            // 启动动画
            setTimeout(() => {
                document.getElementById('startupAnimation').classList.add('hidden');
                
                // 检查是否需要AI测评
                setTimeout(() => {
                    checkNeedAssessment();
                }, 500);
            }, 4000);
        }
        
        // 检查是否需要AI测评
        function checkNeedAssessment() {
            // 检查是否在当前会话中已完成测评
            const hasCompletedAssessment = localStorage.getItem('mengya_assessment_completed') === 'true';
            const sessionAssessmentCompleted = sessionStorage.getItem('session_assessment_completed') === 'true';
            
            if (!hasCompletedAssessment || !sessionAssessmentCompleted) {
                // 清除之前的测评记录，确保重新测评
                localStorage.removeItem('mengya_assessment_completed');
                localStorage.removeItem('mengya_assessment_data');
                sessionStorage.removeItem('session_assessment_completed');
                
                // 显示AI测评引导
                showAIAssessmentIntro();
                
                // 显示启动提示
                showNotification('🚀 欢迎使用萌芽AI！即将开始AI能力测评...');
            } else {
                // 如果当前会话已完成测评，直接进入应用
                initializeAppData();
                showWelcomeNotification();
            }
        }
        
        // 显示AI测评介绍
        function showAIAssessmentIntro() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 40px; text-align: center;">
                    <div style="font-size: 64px; margin-bottom: 20px;">🤖</div>
                    <h2 style="font-size: 24px; font-weight: 700; color: #1d1d1f; margin-bottom: 12px;">AI智能测评</h2>
                    <p style="color: #8e8e93; font-size: 16px; margin-bottom: 32px; line-height: 1.5;">
                        为了给你提供最适合的学习内容，<br>
                        AI助教需要先了解你的能力水平
                    </p>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 24px; margin-bottom: 32px;">
                        <h3 style="margin-bottom: 16px;">🎯 AI测评特色</h3>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 12px; text-align: left;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="background: rgba(255, 255, 255, 0.2); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">🧠</div>
                                <span>智能分析五大核心能力水平</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="background: rgba(255, 255, 255, 0.2); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">🎯</div>
                                <span>AI自动生成个性化学习路径</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="background: rgba(255, 255, 255, 0.2); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">📚</div>
                                <span>基于学科内容的智能内容生成</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="background: rgba(255, 255, 255, 0.2); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">⏱️</div>
                                <span>约需5分钟，轻松有趣</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 16px; justify-content: center;">
                        <button onclick="startAIAssessment()" style="background: #007AFF; color: white; border: none; padding: 16px 32px; border-radius: 25px; cursor: pointer; font-weight: 600; font-size: 18px; box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);">
                            🚀 开始AI测评
                        </button>
                        <button onclick="skipAssessment()" style="background: #8e8e93; color: white; border: none; padding: 16px 24px; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            跳过测评
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 初始化应用数据
        async function initializeAppData() {
            try {
                // 完整的用户数据
                await MengyaUtils.Data.setData('child.profile', {
                    nickname: '小明',
                    avatar: '👦',
                    level: 4,
                    experience: 320,
                    joinDate: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString(),
                    preferences: {
                        favoriteSubject: 'creativity',
                        learningStyle: 'visual',
                        difficulty: 'intermediate'
                    }
                });

                // 详细的学习进度
                await MengyaUtils.Data.setData('child.progress', {
                    totalTasks: 18,
                    completedTasks: 12,
                    currentStreak: 5,
                    maxStreak: 9,
                    todayTasks: 3,
                    todayExp: 45,
                    todayTime: 25,
                    weeklyGoal: 5,
                    monthlyGoal: 20,
                    abilities: {
                        expression: 65,
                        logic: 45,
                        creativity: 80,
                        exploration: 35,
                        habit: 55
                    },
                    weeklyProgress: [
                        { day: '周一', tasks: 2, exp: 30 },
                        { day: '周二', tasks: 1, exp: 15 },
                        { day: '周三', tasks: 3, exp: 45 },
                        { day: '周四', tasks: 2, exp: 30 },
                        { day: '周五', tasks: 1, exp: 15 },
                        { day: '周六', tasks: 2, exp: 30 },
                        { day: '周日', tasks: 1, exp: 15 }
                    ]
                });

                // 高级虚拟伙伴系统
                await MengyaUtils.Data.setData('child.virtualPartner', {
                    name: '小芽芽',
                    level: 4,
                    growth: 580,
                    activity: 420,
                    mood: 'excited',
                    personality: 'cheerful',
                    favoriteActivity: 'learning',
                    lastInteraction: new Date().toISOString(),
                    milestones: [100, 300, 500, 800],
                    accessories: {
                        hat: false,
                        glasses: false,
                        bow: true
                    },
                    evolutionStage: 'tree', // seedling -> sprout -> tree -> forest -> wisdom
                    specialAbilities: ['creativity_boost', 'learning_reminder']
                });

                // 丰富的成就系统
                await MengyaUtils.Data.setData('child.achievements', [
                    {
                        id: 'first-step',
                        name: '初学者',
                        description: '完成第一个训练任务',
                        icon: '🌱',
                        category: 'milestone',
                        rarity: 'common',
                        unlockTime: new Date(Date.now() - 6 * 24 * 60 * 60 * 1000).toISOString(),
                        notified: true
                    },
                    {
                        id: 'creative-master',
                        name: '创意大师',
                        description: '创造力达到80点',
                        icon: '🎨',
                        category: 'ability',
                        rarity: 'rare',
                        unlockTime: new Date(Date.now() - 10 * 60 * 1000).toISOString(),
                        notified: false
                    },
                    {
                        id: 'expression-expert',
                        name: '表达专家',
                        description: '表达力达到60点',
                        icon: '💬',
                        category: 'ability',
                        rarity: 'uncommon',
                        unlockTime: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                        notified: true
                    },
                    {
                        id: 'streak-champion',
                        name: '坚持冠军',
                        description: '连续学习5天',
                        icon: '🔥',
                        category: 'habit',
                        rarity: 'uncommon',
                        unlockTime: new Date().toISOString(),
                        notified: false
                    }
                ]);

                // 学习内容库
                await MengyaUtils.Data.setData('learning.content', {
                    stories: [
                        {
                            id: 'rabbit_adventure',
                            title: '小兔子的冒险',
                            content: '从前有一只勇敢的小兔子...',
                            difficulty: 'easy',
                            skills: ['expression', 'creativity'],
                            likes: 28,
                            author: '小红',
                            aiTags: ['想象力丰富', '情节生动', '语言优美']
                        },
                        {
                            id: 'magic_garden',
                            title: '神奇的花园',
                            content: '在一个神秘的花园里...',
                            difficulty: 'medium',
                            skills: ['exploration', 'logic'],
                            likes: 35,
                            author: '小明',
                            aiTags: ['逻辑清晰', '探索精神', '观察仔细']
                        }
                    ],
                    tasks: [
                        {
                            id: 'expression_basic',
                            name: '看图说话',
                            description: '观察图片，用自己的话描述看到的内容',
                            ability: 'expression',
                            difficulty: 'easy',
                            estimatedTime: 10,
                            rewards: { exp: 15, coins: 5 }
                        },
                        {
                            id: 'logic_puzzle',
                            name: '逻辑拼图',
                            description: '通过逻辑推理完成拼图挑战',
                            ability: 'logic',
                            difficulty: 'medium',
                            estimatedTime: 15,
                            rewards: { exp: 20, coins: 8 }
                        }
                    ]
                });
                
                console.log('✅ 应用数据初始化完成');
                
            } catch (error) {
                console.error('应用数据初始化失败:', error);
            }
        }
        
        // 更新时间显示
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('currentTime').textContent = timeString;
        }
        
        // 显示欢迎通知
        function showWelcomeNotification() {
            setTimeout(() => {
                showNotification('🌱 欢迎回来！小芽芽想你了！');
            }, 1000);
            
            // 检查是否有新成就
            setTimeout(() => {
                showNotification('🏆 恭喜！你获得了"创意大师"新成就！');
            }, 3000);
        }
        
        // iOS通知函数（修复缺失函数）
        function showIOSNotification(message, duration = 3000) {
            showNotification(message, duration);
        }
        
        // iOS风格通知
        function showNotification(message, duration = 3000) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: absolute;
                top: 50px;
                left: 50%;
                transform: translateX(-50%) translateY(-100px);
                background: rgba(0, 0, 0, 0.85);
                color: white;
                padding: 12px 20px;
                border-radius: 12px;
                font-size: 14px;
                font-weight: 500;
                backdrop-filter: blur(20px);
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                z-index: 1001;
                max-width: 280px;
                text-align: center;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(-100px)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 400);
            }, duration);
        }
        
        // Tab切换功能
        function switchTab(tab) {
            document.querySelectorAll('.tab-item').forEach(item => {
                item.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
            
            // 根据tab参数切换到对应界面
            switch(tab) {
                case 'home':
                    switchToHomeInterface();
                    showNotification('🏠 首页');
                    break;
                case 'learning':
                    switchToTrainingInterface();
                    showNotification('🎯 训练中心');
                    break;
                case 'ai':
                    switchToAIInterface();
                    showNotification('🤖 AI助教');
                    break;
                case 'story':
                    switchToStoryInterface();
                    showNotification('📚 故事墙');
                    break;
                case 'profile':
                    switchToProfileInterface();
                    showNotification('👤 个人中心');
                    break;
                case 'parent':
                    openParentPortal();
                    showNotification('👨‍👩‍👧‍👦 家长端');
                    break;
            }
        }
        
        // 功能入口
        function openTrainingCenter() {
            showNotification('🎯 正在打开能力训练中心...');
            
            // 模拟页面切换到训练界面
            setTimeout(() => {
                switchToTrainingInterface();
            }, 1000);
        }
        
        function openPartnerCenter() {
            showNotification('🌱 查看学习伙伴的成长记录...');
            
            // 切换到伙伴详细界面
            setTimeout(() => {
                switchToPartnerInterface();
            }, 1000);
        }
        
        function openAIAssistant() {
            showNotification('🤖 AI助教准备就绪...');
            
            // 切换到AI对话界面
            setTimeout(() => {
                switchToAIInterface();
            }, 1000);
        }
        
        function openStoryWall() {
            showNotification('📚 正在加载故事内容...');
            
            // 切换到故事界面
            setTimeout(() => {
                switchToStoryInterface();
            }, 1000);
        }
        
        function openProfileCenter() {
            showNotification('👤 正在加载个人数据...');
            
            // 切换到个人中心界面
            setTimeout(() => {
                switchToProfileInterface();
            }, 1000);
        }
        
        // 伙伴交互功能（仅用于查看，不主动增加成长值）
        function interactWithPartner() {
            showNotification('🌱 小芽芽正在安静等待，完成训练任务让它成长吧！');
        }
        
        function likeStory() {
            showNotification('❤️ 已为《小兔子的冒险》点赞！');
        }
        
        function shareStory() {
            showNotification('📤 故事分享成功！你的朋友们会看到这个精彩故事！');
        }
        
        // 界面切换函数
        function switchToTrainingInterface() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="switchToHomeInterface()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">能力训练中心</h2>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
                        <div onclick="startTraining('expression')" style="background: white; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="font-size: 32px; margin-bottom: 12px;">💬</div>
                            <div style="font-size: 16px; font-weight: 600; color: #1d1d1f; margin-bottom: 8px;">表达力训练</div>
                            <div style="font-size: 14px; color: #8e8e93; margin-bottom: 12px;">提升语言表达能力</div>
                            <div style="background: #e5e5ea; height: 6px; border-radius: 3px; margin-bottom: 8px; overflow: hidden;">
                                <div style="background: #007AFF; height: 100%; width: 65%; border-radius: 3px;"></div>
                            </div>
                            <div style="font-size: 12px; color: #007AFF; font-weight: 600;">65/100 - 进行中</div>
                        </div>
                        
                        <div onclick="startTraining('logic')" style="background: white; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="font-size: 32px; margin-bottom: 12px;">🧠</div>
                            <div style="font-size: 16px; font-weight: 600; color: #1d1d1f; margin-bottom: 8px;">逻辑力训练</div>
                            <div style="font-size: 14px; color: #8e8e93; margin-bottom: 12px;">增强推理思考能力</div>
                            <div style="background: #e5e5ea; height: 6px; border-radius: 3px; margin-bottom: 8px; overflow: hidden;">
                                <div style="background: #007AFF; height: 100%; width: 45%; border-radius: 3px;"></div>
                            </div>
                            <div style="font-size: 12px; color: #007AFF; font-weight: 600;">45/100 - 进行中</div>
                        </div>
                        
                        <div onclick="startTraining('creativity')" style="background: white; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="font-size: 32px; margin-bottom: 12px;">🎨</div>
                            <div style="font-size: 16px; font-weight: 600; color: #1d1d1f; margin-bottom: 8px;">创造力训练</div>
                            <div style="font-size: 14px; color: #8e8e93; margin-bottom: 12px;">激发想象力和创新</div>
                            <div style="background: #e5e5ea; height: 6px; border-radius: 3px; margin-bottom: 8px; overflow: hidden;">
                                <div style="background: #34d399; height: 100%; width: 80%; border-radius: 3px;"></div>
                            </div>
                            <div style="font-size: 12px; color: #34d399; font-weight: 600;">80/100 - 优秀</div>
                        </div>
                        
                        <div onclick="startTraining('exploration')" style="background: white; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="font-size: 32px; margin-bottom: 12px;">🔍</div>
                            <div style="font-size: 16px; font-weight: 600; color: #1d1d1f; margin-bottom: 8px;">探究力训练</div>
                            <div style="font-size: 14px; color: #8e8e93; margin-bottom: 12px;">培养好奇心和探索</div>
                            <div style="background: #e5e5ea; height: 6px; border-radius: 3px; margin-bottom: 8px; overflow: hidden;">
                                <div style="background: #007AFF; height: 100%; width: 35%; border-radius: 3px;"></div>
                            </div>
                            <div style="font-size: 12px; color: #007AFF; font-weight: 600;">35/100 - 进行中</div>
                        </div>
                    </div>
                    
                    <div style="background: white; border-radius: 12px; padding: 20px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 16px;">🎯</div>
                        <h3 style="color: #1d1d1f; margin-bottom: 8px;">选择训练项目</h3>
                        <p style="color: #8e8e93; font-size: 14px;">点击上方卡片开始相应的能力训练</p>
                    </div>
                </div>
            `;
        }
        
        function switchToAIInterface() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="height: 100%; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid #e5e5ea;">
                        <button onclick="switchToHomeInterface()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回
                        </button>
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 18px; font-weight: 700; color: #1d1d1f;">AI助教小萌</div>
                            <div style="font-size: 12px; color: #34d399;">● 在线</div>
                        </div>
                    </div>
                    
                    <div style="flex: 1; overflow-y: auto; padding: 20px;" id="chatArea">
                        <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 12px;">🤖</div>
                            <h3 style="color: #1d1d1f; margin-bottom: 8px;">AI助教小萌</h3>
                            <p style="color: #8e8e93; font-size: 14px;">你好小明！我看到你的创造力很棒，已经80点了！有什么可以帮助你的吗？</p>
                        </div>
                        
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px;">
                            <button onclick="sendQuickAIMessage('我的进度怎么样')" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 8px 12px; border-radius: 16px; font-size: 12px; cursor: pointer; color: #1d1d1f;">📊 查看进度</button>
                            <button onclick="sendQuickAIMessage('小芽芽怎么样了')" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 8px 12px; border-radius: 16px; font-size: 12px; cursor: pointer; color: #1d1d1f;">🌱 伙伴状态</button>
                            <button onclick="sendQuickAIMessage('我想学习')" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 8px 12px; border-radius: 16px; font-size: 12px; cursor: pointer; color: #1d1d1f;">🎓 开始学习</button>
                            <button onclick="sendQuickAIMessage('给我讲个故事')" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 8px 12px; border-radius: 16px; font-size: 12px; cursor: pointer; color: #1d1d1f;">📚 听故事</button>
                        </div>
                        
                        <div id="chatMessages"></div>
                    </div>
                    
                    <div style="padding: 16px 20px; border-top: 1px solid #e5e5ea; background: white;">
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <input type="text" id="chatInput" placeholder="输入你想说的话..." style="flex: 1; padding: 12px 16px; border: 1px solid #e5e5ea; border-radius: 20px; outline: none; font-size: 14px;" onkeypress="handleChatKeyPress(event)">
                            <button onclick="sendChatMessage()" style="background: #007AFF; color: white; border: none; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function switchToStoryInterface() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;">
                        <div style="display: flex; align-items: center;">
                            <button onclick="switchToHomeInterface()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                                <i class="fas fa-arrow-left"></i> 返回
                            </button>
                            <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">故事创作墙</h2>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button onclick="openStoryPublish()" style="background: #007AFF; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                <i class="fas fa-plus"></i> 发布故事
                            </button>
                            <button onclick="openCollaboration()" style="background: #34d399; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                <i class="fas fa-users"></i> 共创故事
                            </button>
                        </div>
                    </div>
                    
                    <!-- 共创故事推荐 -->
                    <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 12px; padding: 20px; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 20px;">🤝</span>
                                <span style="font-size: 16px; font-weight: 600;">正在共创</span>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.2); padding: 4px 8px; border-radius: 8px; font-size: 11px;">3人参与</div>
                        </div>
                        <h3 style="margin-bottom: 8px;">《森林大冒险》- 多人接龙故事</h3>
                        <p style="opacity: 0.9; font-size: 13px; margin-bottom: 12px;">
                            小明开始：在一个阳光明媚的早晨，小熊决定去森林探险...<br>
                            小红接龙：突然，小熊听到了奇怪的声音，它小心翼翼地走向声音来源...<br>
                            <span style="color: #fff3cd;">等待你来续写 → </span>
                        </p>
                        <button onclick="joinCollaboration()" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ✏️ 接下去写
                        </button>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 16px;">
                        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="width: 32px; height: 32px; background: #ff9500; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: bold;">小</div>
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: #1d1d1f;">小红</div>
                                    <div style="font-size: 12px; color: #8e8e93;">2小时前</div>
                                </div>
                                <div style="margin-left: auto; background: #ff3b30; color: white; padding: 4px 8px; border-radius: 12px; font-size: 10px; font-weight: bold;">🔥 热门</div>
                            </div>
                            <h3 style="color: #1d1d1f; margin-bottom: 8px;">《小兔子的冒险》</h3>
                            <p style="color: #3a3a3c; font-size: 14px; line-height: 1.5; margin-bottom: 12px;">从前有一只勇敢的小兔子，它住在美丽的森林里。有一天，小兔子决定去寻找传说中的彩虹花，开始了一段奇妙的冒险之旅。在路上，它遇到了智慧的老猫头鹰，友善的小松鼠，还有神秘的魔法师...</p>
                            <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                                <span style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 8px; font-size: 11px;">想象力丰富</span>
                                <span style="background: #e8f5e8; color: #388e3c; padding: 4px 8px; border-radius: 8px; font-size: 11px;">情节生动</span>
                                <span style="background: #fce4ec; color: #c2185b; padding: 4px 8px; border-radius: 8px; font-size: 11px;">语言优美</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; gap: 16px;">
                                    <button onclick="likeStoryDetail()" style="background: none; border: none; color: #ff3b30; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                                        <i class="fas fa-heart"></i> <span id="likeCount">28</span>
                                    </button>
                                    <button onclick="commentStory()" style="background: none; border: none; color: #8e8e93; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                                        <i class="fas fa-comment"></i> 12
                                    </button>
                                    <button onclick="shareStoryDetail()" style="background: none; border: none; color: #007AFF; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                                        <i class="fas fa-share"></i> 分享
                                    </button>
                                </div>
                                <div style="background: #007AFF; color: white; padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600;">AI评分: 96分</div>
                            </div>
                        </div>
                        
                        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="width: 32px; height: 32px; background: #34d399; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: bold;">明</div>
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: #1d1d1f;">小明</div>
                                    <div style="font-size: 12px; color: #8e8e93;">1天前</div>
                                </div>
                                <div style="margin-left: auto; background: #667eea; color: white; padding: 4px 8px; border-radius: 12px; font-size: 10px; font-weight: bold;">原创</div>
                            </div>
                            <h3 style="color: #1d1d1f; margin-bottom: 8px;">《神奇的花园》</h3>
                            <p style="color: #3a3a3c; font-size: 14px; line-height: 1.5; margin-bottom: 12px;">在一个神秘的花园里，住着会说话的花朵。每当有小朋友来到花园，花朵们就会用甜美的声音讲述它们经历的奇妙冒险。有一天，一个小女孩误入了这个花园...</p>
                            <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                                <span style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 8px; font-size: 11px;">逻辑清晰</span>
                                <span style="background: #fff3e0; color: #f57c00; padding: 4px 8px; border-radius: 8px; font-size: 11px;">探索精神</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; gap: 16px;">
                                    <button onclick="likeStorySecond()" style="background: none; border: none; color: #ff3b30; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                                        <i class="fas fa-heart"></i> <span id="likeCount2">35</span>
                                    </button>
                                    <button onclick="commentStory()" style="background: none; border: none; color: #8e8e93; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                                        <i class="fas fa-comment"></i> 18
                                    </button>
                                    <button onclick="shareStoryDetail()" style="background: none; border: none; color: #007AFF; cursor: pointer; display: flex; align-items: center; gap: 4px;">
                                        <i class="fas fa-share"></i> 分享
                                    </button>
                                </div>
                                <div style="background: #34d399; color: white; padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600;">AI评分: 89分</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function switchToPartnerInterface() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="switchToHomeInterface()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">我的学习伙伴</h2>
                    </div>
                    
                    <!-- 伙伴主要信息卡片 -->
                    <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 20px; padding: 24px; margin-bottom: 20px; border: 1px solid #bbf7d0;">
                        <div style="text-align: center; margin-bottom: 24px;">
                            <div style="position: relative; display: inline-block; margin-bottom: 16px;">
                                <div style="width: 120px; height: 120px; background: linear-gradient(135deg, #a7f3d0, #34d399); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 12px 40px rgba(52, 211, 153, 0.3); margin: 0 auto; cursor: pointer;" onclick="partnerBigInteraction()">
                                    <div style="font-size: 60px;">🌳</div>
                                </div>
                                <div style="position: absolute; top: -8px; right: -8px; background: #059669; color: white; border-radius: 16px; padding: 4px 12px; font-size: 12px; font-weight: 700; box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);">Lv.4</div>
                            </div>
                            
                            <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 8px; color: #065f46;">小芽芽</h3>
                            <p style="font-size: 16px; color: #047857; margin-bottom: 20px;">智慧成长树</p>
                            
                            <!-- 状态标签 -->
                            <div style="display: inline-flex; align-items: center; background: #f0f9ff; color: #0c4a6e; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid #bae6fd;">
                                💤 安静等待中...
                            </div>
                        </div>
                        
                        <!-- 数据展示 -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                            <div style="background: white; padding: 16px; border-radius: 12px; text-align: center; border: 1px solid #d1fae5;">
                                <div style="font-size: 24px; font-weight: 700; margin-bottom: 4px; color: #059669;">580</div>
                                <div style="font-size: 12px; color: #6b7280;">成长值</div>
                            </div>
                            <div style="background: white; padding: 16px; border-radius: 12px; text-align: center; border: 1px solid #d1fae5;">
                                <div style="font-size: 24px; font-weight: 700; margin-bottom: 4px; color: #0891b2;">3</div>
                                <div style="font-size: 12px; color: #6b7280;">连续学习天数</div>
                            </div>
                        </div>
                        
                        <!-- 成长进度 -->
                        <div style="background: white; border-radius: 12px; padding: 16px; border: 1px solid #d1fae5;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 14px; font-weight: 600; color: #374151;">成长进度</span>
                                <span style="font-size: 12px; color: #6b7280;">580 / 800</span>
                            </div>
                            <div style="background: #f3f4f6; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 8px;">
                                <div style="background: linear-gradient(90deg, #34d399, #059669); width: 72.5%; height: 100%; border-radius: 4px; transition: width 0.5s ease;"></div>
                            </div>
                            <div style="font-size: 12px; color: #6b7280; text-align: center;">还需要 220 成长值即可进化到 Lv.5</div>
                        </div>
                    </div>
                    
                    <!-- 成长规则说明 -->
                    <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <span style="font-size: 16px; margin-right: 8px;">💡</span>
                            <span style="font-size: 14px; font-weight: 600; color: #92400e;">成长规则</span>
                        </div>
                        <div style="font-size: 13px; color: #92400e; line-height: 1.4;">
                            • 完成训练任务可获得成长值 (+15~30)<br>
                            • 连续学习有额外奖励 (+10~50)<br>
                            • 如果超过2天没有学习，成长值会减少 (-20)
                        </div>
                    </div>
                    
                    <!-- 最近成长记录 -->
                    <div style="background: white; border-radius: 12px; padding: 16px; border: 1px solid #e5e7eb;">
                        <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #1f2937;">最近成长记录</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f9fafb; border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 32px; height: 32px; background: #34d399; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <span style="font-size: 14px;">✅</span>
                                    </div>
                                    <div>
                                        <div style="font-size: 14px; font-weight: 500; color: #1f2937;">完成创造力训练</div>
                                        <div style="font-size: 12px; color: #6b7280;">今天 14:30</div>
                                    </div>
                                </div>
                                <span style="font-size: 14px; font-weight: 600; color: #059669;">+25</span>
                            </div>
                            
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f9fafb; border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 32px; height: 32px; background: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <span style="font-size: 14px;">🔥</span>
                                    </div>
                                    <div>
                                        <div style="font-size: 14px; font-weight: 500; color: #1f2937;">连续学习奖励</div>
                                        <div style="font-size: 12px; color: #6b7280;">昨天</div>
                                    </div>
                                </div>
                                <span style="font-size: 14px; font-weight: 600; color: #059669;">+30</span>
                            </div>
                            
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f9fafb; border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 32px; height: 32px; background: #8b5cf6; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <span style="font-size: 14px;">🏆</span>
                                    </div>
                                    <div>
                                        <div style="font-size: 14px; font-weight: 500; color: #1f2937;">获得"创意大师"成就</div>
                                        <div style="font-size: 12px; color: #6b7280;">2天前</div>
                                    </div>
                                </div>
                                <span style="font-size: 14px; font-weight: 600; color: #059669;">+50</span>
                            </div>
                            
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #fef2f2; border-radius: 8px; border: 1px solid #fecaca;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 32px; height: 32px; background: #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <span style="font-size: 14px;">😴</span>
                                    </div>
                                    <div>
                                        <div style="font-size: 14px; font-weight: 500; color: #1f2937;">学习中断惩罚</div>
                                        <div style="font-size: 12px; color: #6b7280;">3天前（2天未学习）</div>
                                    </div>
                                </div>
                                <span style="font-size: 14px; font-weight: 600; color: #dc2626;">-20</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function switchToProfileInterface() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="switchToHomeInterface()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">个人中心</h2>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 24px; text-align: center; margin-bottom: 20px;">
                        <div style="width: 60px; height: 60px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; margin: 0 auto 12px;">👦</div>
                        <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">小明</h3>
                        <p style="font-size: 14px; opacity: 0.9; margin-bottom: 12px;">Lv.4 智慧小将 • 加入8天</p>
                        <div style="background: rgba(255, 255, 255, 0.2); padding: 8px 16px; border-radius: 12px; display: inline-block;">
                            <i class="fas fa-fire"></i> 连续学习5天
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
                        <div style="background: white; border-radius: 12px; padding: 16px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: #667eea; margin-bottom: 4px;">320</div>
                            <div style="font-size: 12px; color: #8e8e93;">总经验值</div>
                        </div>
                        <div style="background: white; border-radius: 12px; padding: 16px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: #34d399; margin-bottom: 4px;">12</div>
                            <div style="font-size: 12px; color: #8e8e93;">完成任务</div>
                        </div>
                        <div style="background: white; border-radius: 12px; padding: 16px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: #ff9500; margin-bottom: 4px;">4</div>
                            <div style="font-size: 12px; color: #8e8e93;">获得成就</div>
                        </div>
                        <div style="background: white; border-radius: 12px; padding: 16px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: #ff3b30; margin-bottom: 4px;">5.2</div>
                            <div style="font-size: 12px; color: #8e8e93;">学习小时</div>
                        </div>
                    </div>
                    
                    <div style="background: white; border-radius: 12px; padding: 20px;">
                        <h3 style="color: #1d1d1f; margin-bottom: 16px;">我的成就</h3>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                            <div style="aspect-ratio: 1; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative;" onclick="showAchievement('creative-master')">
                                <div style="position: absolute; top: -4px; right: -4px; background: #ff3b30; width: 16px; height: 16px; border-radius: 50%; font-size: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold;">!</div>
                                <div style="font-size: 20px; margin-bottom: 4px;">🎨</div>
                                <div style="font-size: 9px; font-weight: 600; text-align: center;">创意大师</div>
                            </div>
                            <div style="aspect-ratio: 1; background: linear-gradient(135deg, #34d399, #10b981); color: white; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;" onclick="showAchievement('expression-expert')">
                                <div style="font-size: 20px; margin-bottom: 4px;">💬</div>
                                <div style="font-size: 9px; font-weight: 600; text-align: center;">表达专家</div>
                            </div>
                            <div style="aspect-ratio: 1; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;" onclick="showAchievement('streak-champion')">
                                <div style="font-size: 20px; margin-bottom: 4px;">🔥</div>
                                <div style="font-size: 9px; font-weight: 600; text-align: center;">坚持冠军</div>
                            </div>
                            <div style="aspect-ratio: 1; background: #f2f2f7; border: 2px dashed #d1d5db; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #8e8e93;">
                                <div style="font-size: 20px; margin-bottom: 4px;">🔒</div>
                                <div style="font-size: 9px; font-weight: 600; text-align: center;">待解锁</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function switchToHomeInterface() {
            // 完全重置并重新加载首页内容
            const appContent = document.getElementById('appContent');
            
            // 清空内容
            appContent.innerHTML = '';
            
            // 重新初始化首页
            initializeMainInterface();
            
            // 重新设置底部导航状态
            resetTabNavigation();
            
            // 立即应用样式，不等待
            applyHomePageStyles();
            
            // 显示重置通知
            showNotification('🏠 已返回首页');
        }
        
        // 专门用于应用首页样式的函数
        function applyHomePageStyles() {
            // 移除之前的动态样式
            const existingStyle = document.getElementById('homepage-dynamic-styles');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            // 创建新的样式元素
            const style = document.createElement('style');
            style.id = 'homepage-dynamic-styles';
            style.textContent = `
                .today-learning {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                    color: white !important;
                    border-radius: 16px !important;
                    padding: 20px !important;
                    margin-bottom: 20px !important;
                    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3) !important;
                }
                .learning-header {
                    display: flex !important;
                    justify-content: space-between !important;
                    align-items: center !important;
                    margin-bottom: 16px !important;
                }
                .learning-title {
                    font-size: 18px !important;
                    font-weight: 700 !important;
                }
                .learning-streak {
                    background: rgba(255, 255, 255, 0.2) !important;
                    padding: 4px 12px !important;
                    border-radius: 12px !important;
                    font-size: 12px !important;
                    font-weight: 600 !important;
                }
                .learning-stats {
                    display: grid !important;
                    grid-template-columns: repeat(3, 1fr) !important;
                    gap: 16px !important;
                }
                .stat-item {
                    text-align: center !important;
                    background: rgba(255, 255, 255, 0.15) !important;
                    padding: 12px !important;
                    border-radius: 12px !important;
                }
                .stat-number {
                    font-size: 24px !important;
                    font-weight: 700 !important;
                    margin-bottom: 4px !important;
                }
                .stat-label {
                    font-size: 12px !important;
                    opacity: 0.9 !important;
                }
                .ability-grid {
                    display: grid !important;
                    grid-template-columns: repeat(2, 1fr) !important;
                    gap: 12px !important;
                }
                .ability-item {
                    background: white !important;
                    border-radius: 12px !important;
                    padding: 16px !important;
                    text-align: center !important;
                    cursor: pointer !important;
                    transition: all 0.3s ease !important;
                    border: 2px solid transparent !important;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
                }
                .ability-item:hover {
                    transform: translateY(-2px) !important;
                    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15) !important;
                }
                .ability-item.completed {
                    border-color: #34d399 !important;
                    background: linear-gradient(135deg, #f0fdf4, #dcfce7) !important;
                }
                .ability-icon {
                    font-size: 32px !important;
                    margin-bottom: 8px !important;
                }
                .ability-name {
                    font-size: 14px !important;
                    font-weight: 600 !important;
                    color: #1f2937 !important;
                    margin-bottom: 4px !important;
                }
                .ability-progress {
                    font-size: 12px !important;
                    color: #6b7280 !important;
                    font-weight: 500 !important;
                }
                .ability-item.completed .ability-progress {
                    color: #059669 !important;
                    font-weight: 600 !important;
                }
            `;
            document.head.appendChild(style);
        }
        
        // 初始化主界面
        function initializeMainInterface() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px; background: #f8fafc; min-height: 100vh;">
                    <!-- 欢迎横幅 -->
                    <div class="today-learning">
                        <div class="learning-header">
                            <div class="learning-title">今日学习</div>
                            <div class="learning-streak">🔥 连续5天</div>
                        </div>
                        <div class="learning-stats">
                            <div class="stat-item">
                                <div class="stat-number" id="todayTasks">3</div>
                                <div class="stat-label">完成任务</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="todayExp">45</div>
                                <div class="stat-label">获得经验</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="todayTime">25</div>
                                <div class="stat-label">学习分钟</div>
                            </div>
                        </div>
                    </div>
                
                <!-- 能力训练 -->
                <div class="ios-card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>🎯</span>
                            能力训练
                        </div>
                        <span style="color: #007AFF; font-size: 14px;" onclick="openTrainingCenter()">查看全部</span>
                    </div>
                    <div class="card-content">
                        <div class="ability-grid">
                            <div class="ability-item completed" onclick="openAbilityTraining('expression')">
                                <div class="ability-icon">💬</div>
                                <div class="ability-name">表达力</div>
                                <div class="ability-progress">65/100 ✓</div>
                            </div>
                            <div class="ability-item" onclick="openAbilityTraining('logic')">
                                <div class="ability-icon">🧠</div>
                                <div class="ability-name">逻辑力</div>
                                <div class="ability-progress">45/100</div>
                            </div>
                            <div class="ability-item completed" onclick="openAbilityTraining('creativity')">
                                <div class="ability-icon">🎨</div>
                                <div class="ability-name">创造力</div>
                                <div class="ability-progress">80/100 ✓</div>
                            </div>
                            <div class="ability-item" onclick="openAbilityTraining('exploration')">
                                <div class="ability-icon">🔍</div>
                                <div class="ability-name">探究力</div>
                                <div class="ability-progress">35/100</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 虚拟伙伴 -->
                <div class="ios-card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>🌱</span>
                            我的学习伙伴
                        </div>
                        <span style="color: #34d399; font-size: 14px;" onclick="openPartnerCenter()">详情 ></span>
                    </div>
                    <div class="card-content" style="padding: 20px;">
                        <!-- 伙伴展示区域 -->
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                            <div style="position: relative; width: 80px; height: 80px; background: linear-gradient(135deg, #a7f3d0, #34d399); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 25px rgba(52, 211, 153, 0.3);" onclick="openPartnerCenter()">
                                <div style="font-size: 40px; cursor: pointer;">🌳</div>
                                <div style="position: absolute; top: -5px; right: -5px; background: #10b981; color: white; border-radius: 12px; padding: 2px 6px; font-size: 10px; font-weight: 600;">Lv.4</div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 18px; font-weight: 700; color: #1d1d1f; margin-bottom: 4px;">小芽芽</div>
                                <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">智慧成长树</div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="background: #f0fdf4; color: #166534; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">
                                        📈 成长值: 580
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 成长进度条 -->
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="font-size: 12px; color: #6b7280;">距离下次进化</span>
                                <span style="font-size: 12px; color: #6b7280;">220/800</span>
                            </div>
                            <div style="background: #f3f4f6; height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #34d399, #10b981); width: 27.5%; height: 100%; border-radius: 3px; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                        
                        <!-- 状态提示 -->
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; text-align: center;">
                            <div style="font-size: 13px; color: #64748b; margin-bottom: 4px;">💤 小芽芽在安静等待...</div>
                            <div style="font-size: 12px; color: #94a3b8;">完成训练任务可以获得成长值哦！</div>
                        </div>
                    </div>
                </div>
                
                <!-- AI助教卡片 -->
                <div class="ios-card" onclick="openAIAssistant()">
                    <div class="card-content" style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div style="width: 50px; height: 50px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">🤖</div>
                            <div style="flex: 1;">
                                <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">AI助教小萌</div>
                                <div style="font-size: 14px; opacity: 0.9;">你好小明！今天想学什么呢？</div>
                            </div>
                            <div style="background: #ff3b30; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold;">3</div>
                        </div>
                    </div>
                </div>
                
                <!-- 最近活动 -->
                <div class="ios-card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>📊</span>
                            最近活动
                        </div>
                        <span style="color: #007AFF; font-size: 14px;">查看全部</span>
                    </div>
                    <div class="card-content">
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 8px 0;">
                                <div style="width: 32px; height: 32px; background: #34d399; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px;">✓</div>
                                <div style="flex: 1;">
                                    <div style="font-size: 14px; font-weight: 600; color: #1d1d1f;">完成创造力训练</div>
                                    <div style="font-size: 12px; color: #8e8e93;">获得15经验值 • 刚刚</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 8px 0;">
                                <div style="width: 32px; height: 32px; background: #007AFF; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px;">🎨</div>
                                <div style="flex: 1;">
                                    <div style="font-size: 14px; font-weight: 600; color: #1d1d1f;">获得"创意大师"勋章</div>
                                    <div style="font-size: 12px; color: #8e8e93;">创造力达到80点 • 5分钟前</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 8px 0;">
                                <div style="width: 32px; height: 32px; background: #ff9500; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px;">🌱</div>
                                <div style="flex: 1;">
                                    <div style="font-size: 14px; font-weight: 600; color: #1d1d1f;">小芽芽升级到Lv.4</div>
                                    <div style="font-size: 12px; color: #8e8e93;">伙伴成长里程碑 • 10分钟前</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            `;
            
            // 立即应用样式
            applyHomePageStyles();
            
            // 重新初始化首页交互逻辑
            updateHomePageData();
            setupHomePageInteractions();
        }
        
        // 更新首页数据显示
        function updateHomePageData() {
            // 更新今日学习统计
            const userData = JSON.parse(localStorage.getItem('mengya_user_data') || '{}');
            
            // 更新今日任务数
            const todayTasksEl = document.getElementById('todayTasks');
            if (todayTasksEl) {
                todayTasksEl.textContent = userData.dailyStats?.tasksCompleted || 3;
            }
            
            // 更新今日经验
            const todayExpEl = document.getElementById('todayExp');
            if (todayExpEl) {
                todayExpEl.textContent = userData.dailyStats?.experienceGained || 45;
            }
            
            // 更新学习时间
            const todayTimeEl = document.getElementById('todayTime');
            if (todayTimeEl) {
                todayTimeEl.textContent = userData.dailyStats?.studyMinutes || 25;
            }
            
            // 重新设置首页Tab为活跃状态
            document.querySelectorAll('.tab-item').forEach(item => item.classList.remove('active'));
            const homeTab = document.querySelector('.tab-item[onclick*="switchToHomeInterface"]');
            if (homeTab) {
                homeTab.classList.add('active');
            }
        }
        
        // 设置首页交互
        function setupHomePageInteractions() {
            // 重新绑定所有点击事件已在HTML中定义，无需额外绑定
            console.log('首页交互已重新初始化');
        }
        
        // 重置底部导航状态
        function resetTabNavigation() {
            // 重置所有tab状态
            const tabs = document.querySelectorAll('.tab-item');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 激活首页tab
            const homeTab = document.querySelector('.tab-item[onclick*="switchToHomeInterface"]');
            if (homeTab) {
                homeTab.classList.add('active');
            }
        }
        
        // 训练功能 - 添加具体训练内容
        function startTraining(ability) {
            const trainingContent = {
                expression: {
                    name: '表达力',
                    tasks: [
                        '🖼️ 看图说话：描述这幅画中小猫在做什么',
                        '📖 故事复述：用你的话重新讲述《小红帽》',
                        '🎭 情感表达：表演开心、难过、惊讶的表情',
                        '🎤 演讲练习：介绍你最喜欢的一本书'
                    ]
                },
                logic: {
                    name: '逻辑力',
                    tasks: [
                        '🧩 逻辑推理：如果所有玫瑰都是花，所有花都需要水...',
                        '🔢 数学思维：找出数列1,3,6,10,?的规律',
                        '🔍 问题分析：为什么冬天会下雪？',
                        '⚖️ 因果关系：分析植物生长需要哪些条件'
                    ]
                },
                creativity: {
                    name: '创造力',
                    tasks: [
                        '🎨 创意绘画：画一个你想象中的外星朋友',
                        '📝 故事创作：编写一个关于勇敢小老鼠的故事',
                        '🔧 发明设计：设计一个能帮助妈妈的神奇工具',
                        '💭 想象表达：如果你有超能力，你想要什么能力？'
                    ]
                },
                exploration: {
                    name: '探究力',
                    tasks: [
                        '🔬 科学观察：观察一杯水放在阳光下会发生什么',
                        '🧪 实验探究：混合不同颜色的水彩会变成什么颜色',
                        '❓ 问题提出：为什么天空是蓝色的？',
                        '🔍 假设验证：猜测并验证哪些物品会浮在水面上'
                    ]
                }
            };
            
            const content = trainingContent[ability];
            if (!content) return;
            
            showNotification(`🎯 开始${content.name}训练...`);
            
            // 显示具体训练任务
            setTimeout(() => {
                showDetailedTraining(ability, content);
            }, 1000);
        }
        
        // 显示详细训练内容
        function showDetailedTraining(ability, content) {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="switchToTrainingInterface()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回训练中心
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">${content.name}训练</h2>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 24px; margin-bottom: 20px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 16px;">${ability === 'expression' ? '💬' : ability === 'logic' ? '🧠' : ability === 'creativity' ? '🎨' : '🔍'}</div>
                        <h3 style="margin-bottom: 8px;">${content.name}专项训练</h3>
                        <p style="opacity: 0.9; font-size: 14px;">通过多种练习提升你的${content.name}水平</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr; gap: 16px;">
                        ${content.tasks.map((task, index) => `
                            <div class="function-card" onclick="startSpecificTask('${ability}', ${index}, '${task}')" style="cursor: pointer;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 16px; font-weight: 600; color: #1d1d1f; margin-bottom: 8px;">任务 ${index + 1}</div>
                                        <div style="font-size: 14px; color: #666; line-height: 1.4;">${task}</div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <div style="background: #e8f5e8; color: #388e3c; padding: 4px 8px; border-radius: 6px; font-size: 11px;">5分钟</div>
                                        <button class="action-button" onclick="event.stopPropagation(); startSpecificTask('${ability}', ${index}, '${task}')">开始</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-top: 20px; text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 12px;">🎯</div>
                        <h3 style="color: #1d1d1f; margin-bottom: 8px;">训练说明</h3>
                        <p style="color: #666; font-size: 14px; line-height: 1.5;">
                            每个任务完成后会获得经验值，AI会根据你的表现给出专业反馈和建议。
                            完成所有任务可以解锁新的成就和奖励！
                        </p>
                    </div>
                </div>
            `;
        }
        
        // 开始具体训练任务
        function startSpecificTask(ability, taskIndex, taskDescription) {
            showNotification(`🎯 正在加载训练内容...`);
            
            setTimeout(() => {
                showTaskContent(ability, taskIndex, taskDescription);
            }, 1000);
        }
        
        // 显示任务具体内容
        function showTaskContent(ability, taskIndex, taskDescription) {
            const taskContents = {
                expression: [
                    {
                        title: '看图说话训练',
                        instruction: '仔细观察下面的图片，用自己的话描述你看到的内容',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0; text-align: center;">
                                <div style="font-size: 80px; margin-bottom: 16px;">🐱</div>
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                    <p style="color: #666; font-size: 14px; line-height: 1.5;">
                                        图片描述：一只橙色的小猫正在花园里玩耍，旁边有美丽的花朵和蝴蝶飞舞。
                                    </p>
                                </div>
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">请描述你看到的内容：</label>
                                    <textarea id="taskAnswer" placeholder="我看到了..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                <button onclick="submitTaskAnswer('expression', 0)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">提交答案</button>
                            </div>
                        `,
                        tips: '提示：可以描述小猫的颜色、动作、周围的环境等'
                    },
                    {
                        title: '故事复述训练',
                        instruction: '听完《小红帽》故事后，用你自己的话重新讲述',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                    <h4 style="color: #1d1d1f; margin-bottom: 12px;">📖 《小红帽》故事原文：</h4>
                                    <p style="color: #666; font-size: 14px; line-height: 1.6;">
                                        从前有一个可爱的小女孩，大家都叫她小红帽，因为她总是戴着奶奶给她的红色帽子。
                                        有一天，妈妈让小红帽去看望生病的奶奶，并给奶奶送去一些食物...
                                    </p>
                                </div>
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">请用你的话重新讲述这个故事：</label>
                                    <textarea id="taskAnswer" placeholder="从前有一个..." style="width: 100%; height: 100px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                <button onclick="submitTaskAnswer('expression', 1)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">提交复述</button>
                            </div>
                        `,
                        tips: '提示：用你自己的话，保持故事的主要情节'
                    },
                    {
                        title: '情感表达训练',
                        instruction: '通过表情和动作表达不同的情感',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0; text-align: center;">
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 20px;">
                                    <div onclick="selectEmotion('happy')" style="background: white; border-radius: 8px; padding: 16px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#007AFF'" onmouseout="this.style.borderColor='transparent'">
                                        <div style="font-size: 32px; margin-bottom: 8px;">😊</div>
                                        <div style="font-size: 14px; font-weight: 600;">开心</div>
                                    </div>
                                    <div onclick="selectEmotion('sad')" style="background: white; border-radius: 8px; padding: 16px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#007AFF'" onmouseout="this.style.borderColor='transparent'">
                                        <div style="font-size: 32px; margin-bottom: 8px;">😢</div>
                                        <div style="font-size: 14px; font-weight: 600;">难过</div>
                                    </div>
                                    <div onclick="selectEmotion('surprised')" style="background: white; border-radius: 8px; padding: 16px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#007AFF'" onmouseout="this.style.borderColor='transparent'">
                                        <div style="font-size: 32px; margin-bottom: 8px;">😲</div>
                                        <div style="font-size: 14px; font-weight: 600;">惊讶</div>
                                    </div>
                                </div>
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                    <p style="color: #666; font-size: 14px;">请选择一种情感，然后做出相应的表情和动作</p>
                                </div>
                                <button onclick="submitTaskAnswer('expression', 2)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">完成表演</button>
                            </div>
                        `,
                        tips: '提示：可以配合手势和声音来表达情感'
                    },
                    {
                        title: '演讲练习训练',
                        instruction: '介绍你最喜欢的一本书',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">🎤</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">演讲主题：我最喜欢的书</h4>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">书名：</label>
                                    <input type="text" id="bookName" placeholder="例如：《西游记》" style="width: 100%; padding: 10px 12px; border: 1px solid #e5e5ea; border-radius: 6px; margin-bottom: 12px;">
                                    
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">为什么喜欢这本书：</label>
                                    <textarea id="taskAnswer" placeholder="这本书很有趣，因为..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                <button onclick="submitTaskAnswer('expression', 3)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">开始演讲</button>
                            </div>
                        `,
                        tips: '提示：可以说说书的内容、喜欢的角色、学到的道理'
                    }
                ],
                logic: [
                    {
                        title: '逻辑推理训练',
                        instruction: '根据给出的条件进行逻辑推理',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                    <h4 style="color: #1d1d1f; margin-bottom: 12px;">🧩 逻辑推理题：</h4>
                                    <p style="color: #666; font-size: 14px; line-height: 1.6; margin-bottom: 16px;">
                                        已知条件：<br>
                                        1. 所有的玫瑰都是花<br>
                                        2. 所有的花都需要水<br>
                                        3. 红玫瑰是玫瑰<br><br>
                                        问题：红玫瑰需要水吗？
                                    </p>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                        <button onclick="selectLogicAnswer('yes')" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 12px; border-radius: 8px; cursor: pointer;">✅ 需要水</button>
                                        <button onclick="selectLogicAnswer('no')" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 12px; border-radius: 8px; cursor: pointer;">❌ 不需要水</button>
                                    </div>
                                </div>
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">请解释你的推理过程：</label>
                                    <textarea id="taskAnswer" placeholder="我的推理是..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                <button onclick="submitTaskAnswer('logic', 0)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">提交答案</button>
                            </div>
                        `,
                        tips: '提示：按照逻辑关系一步步推理'
                    },
                    {
                        title: '数学思维训练',
                        instruction: '找出数列的规律',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <h4 style="color: #1d1d1f; margin-bottom: 16px;">🔢 找规律：</h4>
                                    <div style="font-size: 24px; font-weight: 700; color: #007AFF; margin-bottom: 16px;">
                                        1, 3, 6, 10, ?
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px;">
                                        <button onclick="selectMathAnswer(15)" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 10px; border-radius: 6px; cursor: pointer;">15</button>
                                        <button onclick="selectMathAnswer(14)" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 10px; border-radius: 6px; cursor: pointer;">14</button>
                                        <button onclick="selectMathAnswer(16)" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 10px; border-radius: 6px; cursor: pointer;">16</button>
                                        <button onclick="selectMathAnswer(13)" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 10px; border-radius: 6px; cursor: pointer;">13</button>
                                    </div>
                                </div>
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">请说明你发现的规律：</label>
                                    <textarea id="taskAnswer" placeholder="我发现的规律是..." style="width: 100%; height: 60px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                <button onclick="submitTaskAnswer('logic', 1)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">提交答案</button>
                            </div>
                        `,
                        tips: '提示：观察相邻数字之间的关系'
                    },
                    {
                        title: '问题分析训练',
                        instruction: '分析为什么冬天会下雪',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">❄️</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">问题：为什么冬天会下雪？</h4>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">请分析原因：</label>
                                    <textarea id="taskAnswer" placeholder="我认为冬天下雪是因为..." style="width: 100%; height: 100px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                
                                <div style="background: #e3f2fd; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                                    <div style="font-size: 12px; color: #1976d2; font-weight: 600; margin-bottom: 4px;">💡 思考提示：</div>
                                    <div style="font-size: 12px; color: #666;">可以从温度、水蒸气、云朵等角度思考</div>
                                </div>
                                
                                <button onclick="submitTaskAnswer('logic', 2)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">提交分析</button>
                            </div>
                        `,
                        tips: '提示：可以从科学角度分析自然现象'
                    },
                    {
                        title: '因果关系训练',
                        instruction: '分析植物生长需要的条件',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">🌱</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">植物生长需要什么条件？</h4>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">请选择植物生长需要的条件：</div>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: white; border-radius: 6px; cursor: pointer;">
                                            <input type="checkbox" id="sunlight"> 阳光 ☀️
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: white; border-radius: 6px; cursor: pointer;">
                                            <input type="checkbox" id="water"> 水分 💧
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: white; border-radius: 6px; cursor: pointer;">
                                            <input type="checkbox" id="soil"> 土壤 🌍
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: white; border-radius: 6px; cursor: pointer;">
                                            <input type="checkbox" id="air"> 空气 🌬️
                                        </label>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">请解释这些条件的作用：</label>
                                    <textarea id="taskAnswer" placeholder="阳光的作用是...水分的作用是..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                <button onclick="submitTaskAnswer('logic', 3)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">提交答案</button>
                            </div>
                        `,
                        tips: '提示：思考每个条件对植物的重要性'
                    }
                ],
                creativity: [
                    {
                        title: '创意绘画训练',
                        instruction: '画一个你想象中的外星朋友',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0; text-align: center;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">🎨</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">创意绘画：外星朋友</h4>
                                </div>
                                
                                <div style="background: white; border: 2px dashed #ddd; border-radius: 8px; height: 200px; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; color: #666;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 32px; margin-bottom: 8px;">🖌️</div>
                                        <div>在这里画出你的外星朋友</div>
                                        <div style="font-size: 12px; margin-top: 4px;">（实际应用中可集成绘画工具）</div>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">描述你的外星朋友：</label>
                                    <textarea id="taskAnswer" placeholder="我的外星朋友长得像...它有什么特殊能力..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                <button onclick="submitTaskAnswer('creativity', 0)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">完成创作</button>
                            </div>
                        `,
                        tips: '提示：发挥想象力，外星朋友可以有任何特征'
                    },
                    {
                        title: '故事创作训练',
                        instruction: '编写一个关于勇敢小老鼠的故事',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">🐭</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">故事创作：勇敢的小老鼠</h4>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">故事标题：</label>
                                    <input type="text" id="storyTitleCreative" placeholder="例如：《小老鼠的大冒险》" style="width: 100%; padding: 10px 12px; border: 1px solid #e5e5ea; border-radius: 6px; margin-bottom: 12px;">
                                    
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">故事内容：</label>
                                    <textarea id="taskAnswer" placeholder="从前有一只勇敢的小老鼠..." style="width: 100%; height: 120px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none; line-height: 1.5;"></textarea>
                                </div>
                                
                                <div style="background: #e8f5e8; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                                    <div style="font-size: 12px; color: #388e3c; font-weight: 600; margin-bottom: 4px;">💡 创作提示：</div>
                                    <div style="font-size: 12px; color: #666;">故事要有开头、经过、结尾，可以加入冒险、友情、成长等元素</div>
                                </div>
                                
                                <button onclick="submitTaskAnswer('creativity', 1)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">完成创作</button>
                            </div>
                        `,
                        tips: '提示：让故事有趣生动，加入你的想象力'
                    },
                    {
                        title: '发明设计训练',
                        instruction: '设计一个能帮助妈妈的神奇工具',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">🔧</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">发明设计：帮助妈妈的工具</h4>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">发明名称：</label>
                                    <input type="text" id="inventionName" placeholder="例如：超级清洁机器人" style="width: 100%; padding: 10px 12px; border: 1px solid #e5e5ea; border-radius: 6px; margin-bottom: 12px;">
                                    
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">工具功能：</label>
                                    <textarea id="taskAnswer" placeholder="这个工具可以帮助妈妈..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                
                                <div style="background: white; border: 2px dashed #ddd; border-radius: 8px; height: 120px; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; color: #666;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 24px; margin-bottom: 8px;">✏️</div>
                                        <div>画出你的发明设计图</div>
                                    </div>
                                </div>
                                
                                <button onclick="submitTaskAnswer('creativity', 2)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">完成设计</button>
                            </div>
                        `,
                        tips: '提示：想想妈妈平时做什么事情比较辛苦'
                    },
                    {
                        title: '想象表达训练',
                        instruction: '如果你有超能力，你想要什么能力？',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">🦸</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">想象表达：我的超能力</h4>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">选择你想要的超能力：</div>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 12px;">
                                        <button onclick="selectSuperpower('fly')" style="background: white; border: 1px solid #e5e5ea; padding: 12px; border-radius: 8px; cursor: pointer;">🦅 飞行</button>
                                        <button onclick="selectSuperpower('invisible')" style="background: white; border: 1px solid #e5e5ea; padding: 12px; border-radius: 8px; cursor: pointer;">👻 隐身</button>
                                        <button onclick="selectSuperpower('time')" style="background: white; border: 1px solid #e5e5ea; padding: 12px; border-radius: 8px; cursor: pointer;">⏰ 时间控制</button>
                                        <button onclick="selectSuperpower('mind')" style="background: white; border: 1px solid #e5e5ea; padding: 12px; border-radius: 8px; cursor: pointer;">🧠 读心术</button>
                                    </div>
                                    
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">说说你为什么选择这个超能力，你会用它做什么：</label>
                                    <textarea id="taskAnswer" placeholder="我选择这个超能力是因为...我会用它来..." style="width: 100%; height: 100px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                
                                <button onclick="submitTaskAnswer('creativity', 3)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">分享想法</button>
                            </div>
                        `,
                        tips: '提示：发挥想象力，想想超能力能帮助谁'
                    }
                ],
                exploration: [
                    {
                        title: '科学观察训练',
                        instruction: '观察一杯水放在阳光下会发生什么',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">🔬</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">科学观察实验</h4>
                                </div>
                                
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">🧪 实验步骤：</div>
                                    <div style="color: #666; font-size: 13px; line-height: 1.5;">
                                        1. 准备一杯透明的水<br>
                                        2. 将水杯放在阳光直射的地方<br>
                                        3. 观察30分钟，记录变化<br>
                                        4. 思考为什么会有这些变化
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">你观察到了什么变化：</label>
                                    <textarea id="taskAnswer" placeholder="我观察到..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                
                                <button onclick="submitTaskAnswer('exploration', 0)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">提交观察</button>
                            </div>
                        `,
                        tips: '提示：仔细观察水位、温度、蒸汽等变化'
                    },
                    {
                        title: '实验探究训练',
                        instruction: '混合不同颜色的水彩会变成什么颜色',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">🎨</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">颜色混合实验</h4>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">选择要混合的颜色：</div>
                                    <div style="display: flex; gap: 12px; justify-content: center; margin-bottom: 12px;">
                                        <button onclick="selectColor('red')" style="background: #ff4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">🔴 红色</button>
                                        <button onclick="selectColor('blue')" style="background: #4444ff; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">🔵 蓝色</button>
                                        <button onclick="selectColor('yellow')" style="background: #ffdd44; color: black; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">🟡 黄色</button>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">预测混合结果并说明原因：</label>
                                    <textarea id="taskAnswer" placeholder="我觉得红色+蓝色会变成...因为..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                
                                <button onclick="submitTaskAnswer('exploration', 1)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">提交预测</button>
                            </div>
                        `,
                        tips: '提示：想想三原色的混合规律'
                    },
                    {
                        title: '问题提出训练',
                        instruction: '为什么天空是蓝色的？',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">🌌</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">科学探究：天空的颜色</h4>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">你认为天空为什么是蓝色的：</label>
                                    <textarea id="taskAnswer" placeholder="我觉得天空是蓝色的，可能是因为..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">还有什么相关问题想探究：</div>
                                    <div style="display: flex; flex-direction: column; gap: 8px;">
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="checkbox"> 为什么云朵是白色的？
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="checkbox"> 为什么夕阳是红色的？
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="checkbox"> 为什么彩虹有七种颜色？
                                        </label>
                                    </div>
                                </div>
                                
                                <button onclick="submitTaskAnswer('exploration', 2)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">提交探究</button>
                            </div>
                        `,
                        tips: '提示：可以从光线、大气等角度思考'
                    },
                    {
                        title: '假设验证训练',
                        instruction: '猜测并验证哪些物品会浮在水面上',
                        content: `
                            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 16px 0;">
                                <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 12px;">🛟</div>
                                    <h4 style="color: #1d1d1f; margin-bottom: 8px;">浮沉实验</h4>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">预测这些物品在水中的状态：</div>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                        <div style="background: white; border-radius: 6px; padding: 12px; border: 1px solid #e5e5ea;">
                                            <div style="margin-bottom: 8px;">🪨 石头</div>
                                            <select style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                                                <option>选择状态</option>
                                                <option>浮起来</option>
                                                <option>沉下去</option>
                                            </select>
                                        </div>
                                        <div style="background: white; border-radius: 6px; padding: 12px; border: 1px solid #e5e5ea;">
                                            <div style="margin-bottom: 8px;">🪵 木块</div>
                                            <select style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                                                <option>选择状态</option>
                                                <option>浮起来</option>
                                                <option>沉下去</option>
                                            </select>
                                        </div>
                                        <div style="background: white; border-radius: 6px; padding: 12px; border: 1px solid #e5e5ea;">
                                            <div style="margin-bottom: 8px;">🪙 硬币</div>
                                            <select style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                                                <option>选择状态</option>
                                                <option>浮起来</option>
                                                <option>沉下去</option>
                                            </select>
                                        </div>
                                        <div style="background: white; border-radius: 6px; padding: 12px; border: 1px solid #e5e5ea;">
                                            <div style="margin-bottom: 8px;">🎈 气球</div>
                                            <select style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                                                <option>选择状态</option>
                                                <option>浮起来</option>
                                                <option>沉下去</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">解释你的预测理由：</label>
                                    <textarea id="taskAnswer" placeholder="我觉得...会浮起来，因为..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #e5e5ea; border-radius: 8px; resize: none; outline: none;"></textarea>
                                </div>
                                
                                <button onclick="submitTaskAnswer('exploration', 3)" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">提交假设</button>
                            </div>
                        `,
                        tips: '提示：思考物品的重量和体积关系'
                    }
                ]
            };
            
            const content = taskContents[ability][taskIndex];
            if (!content) {
                showNotification('⚠️ 任务内容加载失败');
                return;
            }
            
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="showDetailedTraining('${ability}', {name: '${ability === 'expression' ? '表达力' : ability === 'logic' ? '逻辑力' : ability === 'creativity' ? '创造力' : '探究力'}', tasks: []})" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回任务列表
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">${content.title}</h2>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 20px; margin-bottom: 20px; text-align: center;">
                        <h3 style="margin-bottom: 8px;">任务目标</h3>
                        <p style="opacity: 0.9; font-size: 14px;">${content.instruction}</p>
                    </div>
                    
                    ${content.content}
                    
                    <div style="background: #fff3cd; border-radius: 8px; padding: 12px; margin-top: 16px;">
                        <div style="font-size: 12px; color: #856404; font-weight: 600; margin-bottom: 4px;">💡 ${content.tips}</div>
                    </div>
                </div>
            `;
        }
        
        // 任务交互函数
        function selectEmotion(emotion) {
            document.querySelectorAll('[onclick*="selectEmotion"]').forEach(btn => {
                btn.style.borderColor = 'transparent';
            });
            event.currentTarget.style.borderColor = '#007AFF';
            showNotification(`选择了情感：${emotion === 'happy' ? '开心' : emotion === 'sad' ? '难过' : '惊讶'}`);
        }
        
        function selectLogicAnswer(answer) {
            document.querySelectorAll('[onclick*="selectLogicAnswer"]').forEach(btn => {
                btn.style.background = '#f2f2f7';
            });
            event.currentTarget.style.background = '#007AFF';
            event.currentTarget.style.color = 'white';
            showNotification(`选择答案：${answer === 'yes' ? '需要水' : '不需要水'}`);
        }
        
        function selectMathAnswer(number) {
            document.querySelectorAll('[onclick*="selectMathAnswer"]').forEach(btn => {
                btn.style.background = '#f2f2f7';
                btn.style.color = '#1d1d1f';
            });
            event.currentTarget.style.background = '#007AFF';
            event.currentTarget.style.color = 'white';
            showNotification(`选择答案：${number}`);
        }
        
        function selectSuperpower(power) {
            document.querySelectorAll('[onclick*="selectSuperpower"]').forEach(btn => {
                btn.style.background = 'white';
                btn.style.borderColor = '#e5e5ea';
            });
            event.currentTarget.style.background = '#007AFF';
            event.currentTarget.style.color = 'white';
            event.currentTarget.style.borderColor = '#007AFF';
            
            const powerNames = {
                fly: '飞行',
                invisible: '隐身',
                time: '时间控制',
                mind: '读心术'
            };
            showNotification(`选择超能力：${powerNames[power]}`);
        }
        
        function selectColor(color) {
            const colorNames = {
                red: '红色',
                blue: '蓝色', 
                yellow: '黄色'
            };
            showNotification(`选择颜色：${colorNames[color]}`);
        }
        
        // 提交任务答案
        function submitTaskAnswer(ability, taskIndex) {
            const answer = document.getElementById('taskAnswer').value.trim();
            
            if (!answer) {
                showNotification('⚠️ 请填写答案内容');
                return;
            }
            
            showNotification('📝 正在提交答案...');
            
            setTimeout(() => {
                showNotification('🤖 AI正在分析你的答案...');
            }, 1500);
            
            setTimeout(() => {
                // 显示任务完成结果页面
                showTaskResult(ability, taskIndex, answer);
            }, 3000);
        }
        
        // 显示任务完成结果
        function showTaskResult(ability, taskIndex, userAnswer) {
            const abilityNames = {
                expression: '表达力',
                logic: '逻辑力',
                creativity: '创造力',
                exploration: '探究力'
            };
            
            const abilityName = abilityNames[ability];
            const aiFeedback = getAIFeedback(ability, taskIndex);
            const taskTitles = {
                expression: ['看图说话训练', '故事复述训练', '情感表达训练', '演讲练习训练'],
                logic: ['逻辑推理训练', '数学思维训练', '问题分析训练', '因果关系训练'],
                creativity: ['创意绘画训练', '故事创作训练', '发明设计训练', '想象表达训练'],
                exploration: ['科学观察训练', '实验探究训练', '问题提出训练', '假设验证训练']
            };
            
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="font-size: 64px; margin-bottom: 16px;">🎉</div>
                        <h2 style="font-size: 24px; font-weight: 700; color: #1d1d1f; margin-bottom: 8px;">任务完成！</h2>
                        <p style="color: #8e8e93; font-size: 16px;">${taskTitles[ability][taskIndex]}</p>
                    </div>
                    
                    <!-- AI评价结果 -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 24px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <div style="font-size: 32px;">🤖</div>
                            <div>
                                <h3 style="margin-bottom: 4px;">AI助教评价</h3>
                                <p style="opacity: 0.9; font-size: 14px;">基于你的表现进行专业分析</p>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                            <p style="font-size: 16px; line-height: 1.5; margin-bottom: 12px;">${aiFeedback}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="font-size: 14px; opacity: 0.9;">综合评分</div>
                                <div style="background: rgba(255, 255, 255, 0.2); padding: 6px 12px; border-radius: 8px; font-weight: 700;">
                                    ${85 + Math.floor(Math.random() * 15)}分
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                            <div style="text-align: center;">
                                <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">+3</div>
                                <div style="font-size: 12px; opacity: 0.9;">${abilityName}点数</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">+5</div>
                                <div style="font-size: 12px; opacity: 0.9;">经验值</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px; color: #34d399;">+25</div>
                                <div style="font-size: 12px; opacity: 0.9;">🌱成长值</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">+1</div>
                                <div style="font-size: 12px; opacity: 0.9;">完成任务</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 你的答案回顾 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 12px;">📝 你的答案</h3>
                        <div style="background: #f8fafc; border-radius: 8px; padding: 16px; border-left: 4px solid #667eea;">
                            <p style="color: #374151; font-size: 14px; line-height: 1.5;">${userAnswer}</p>
                        </div>
                    </div>
                    
                    <!-- 学习建议 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 12px;">💡 学习建议</h3>
                        <div style="color: #666; font-size: 14px; line-height: 1.5;">
                            ${getLearningAdvice(ability, taskIndex)}
                        </div>
                    </div>
                    
                    <!-- 小芽芽成长提示 -->
                    <div style="background: linear-gradient(135deg, #dcfce7, #bbf7d0); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #86efac;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <div style="font-size: 32px;">🌳</div>
                            <div>
                                <h3 style="color: #065f46; margin-bottom: 4px;">小芽芽很开心！</h3>
                                <p style="color: #047857; font-size: 14px;">你的努力学习让我又成长了一些 ✨</p>
                            </div>
                        </div>
                        <div style="background: white; border-radius: 8px; padding: 12px; border-left: 4px solid #34d399;">
                            <p style="color: #374151; font-size: 13px; line-height: 1.4;">
                                💪 通过这次训练，我获得了 +25 成长值！<br>
                                🔥 坚持每天学习，我就能更快进化到下一个阶段哦！<br>
                                😴 记住，如果超过2天不学习，我的成长值会减少的...
                            </p>
                        </div>
                    </div>
                    
                    <!-- 下一步操作 -->
                    <div style="display: flex; gap: 12px;">
                        <button onclick="continueNextTask('${ability}', ${taskIndex})" style="flex: 1; background: #007AFF; color: white; border: none; padding: 16px 24px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 16px;">
                            🎯 继续下一个任务
                        </button>
                        <button onclick="showDetailedTraining('${ability}', {name: '${abilityName}', tasks: []})" style="flex: 1; background: #8e8e93; color: white; border: none; padding: 16px 24px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 16px;">
                            📋 返回任务列表
                        </button>
                        <button onclick="switchToHomeInterface()" style="background: #34d399; color: white; border: none; padding: 16px 20px; border-radius: 12px; cursor: pointer; font-weight: 600;">
                            🏠 回到首页
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 继续下一个任务
        function continueNextTask(ability, currentTaskIndex) {
            const nextTaskIndex = currentTaskIndex + 1;
            const maxTasks = 4;
            
            if (nextTaskIndex >= maxTasks) {
                // 所有任务完成，显示能力完成页面
                showAbilityCompleted(ability);
            } else {
                // 继续下一个任务
                const taskDescriptions = {
                    expression: [
                        '🖼️ 看图说话：描述这幅画中小猫在做什么',
                        '📖 故事复述：用你的话重新讲述《小红帽》',
                        '🎭 情感表达：表演开心、难过、惊讶的表情',
                        '🎤 演讲练习：介绍你最喜欢的一本书'
                    ],
                    logic: [
                        '🧩 逻辑推理：如果所有玫瑰都是花，所有花都需要水...',
                        '🔢 数学思维：找出数列1,3,6,10,?的规律',
                        '🔍 问题分析：为什么冬天会下雪？',
                        '⚖️ 因果关系：分析植物生长需要哪些条件'
                    ],
                    creativity: [
                        '🎨 创意绘画：画一个你想象中的外星朋友',
                        '📝 故事创作：编写一个关于勇敢小老鼠的故事',
                        '🔧 发明设计：设计一个能帮助妈妈的神奇工具',
                        '💭 想象表达：如果你有超能力，你想要什么能力？'
                    ],
                    exploration: [
                        '🔬 科学观察：观察一杯水放在阳光下会发生什么',
                        '🧪 实验探究：混合不同颜色的水彩会变成什么颜色',
                        '❓ 问题提出：为什么天空是蓝色的？',
                        '🔍 假设验证：猜测并验证哪些物品会浮在水面上'
                    ]
                };
                
                const nextTask = taskDescriptions[ability][nextTaskIndex];
                showNotification(`🎯 准备下一个任务：${nextTask.split('：')[0]}`);
                
                setTimeout(() => {
                    showTaskContent(ability, nextTaskIndex, nextTask);
                }, 1500);
            }
        }
        
        // 显示能力训练完成页面
        function showAbilityCompleted(ability) {
            const abilityNames = {
                expression: '表达力',
                logic: '逻辑力',
                creativity: '创造力',
                exploration: '探究力'
            };
            
            const abilityName = abilityNames[ability];
            
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px; text-align: center;">
                    <div style="font-size: 80px; margin-bottom: 20px;">🏆</div>
                    <h2 style="font-size: 28px; font-weight: 700; color: #1d1d1f; margin-bottom: 12px;">恭喜完成${abilityName}训练！</h2>
                    <p style="color: #8e8e93; font-size: 16px; margin-bottom: 32px;">你已经完成了所有${abilityName}相关的训练任务</p>
                    
                    <!-- 总体成果 -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 24px; margin-bottom: 24px;">
                        <h3 style="margin-bottom: 16px;">🎯 训练成果</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                            <div style="background: rgba(255, 255, 255, 0.2); padding: 16px; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; margin-bottom: 4px;">+12</div>
                                <div style="font-size: 12px; opacity: 0.9;">${abilityName}点数</div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.2); padding: 16px; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; margin-bottom: 4px;">+20</div>
                                <div style="font-size: 12px; opacity: 0.9;">总经验值</div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.2); padding: 16px; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; margin-bottom: 4px;">4/4</div>
                                <div style="font-size: 12px; opacity: 0.9;">完成任务</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 解锁成就 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 16px;">🏆 解锁新成就</h3>
                        <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border-radius: 12px; padding: 20px; position: relative;">
                            <div style="position: absolute; top: -8px; right: -8px; background: #ff3b30; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">!</div>
                            <div style="font-size: 32px; margin-bottom: 8px;">${ability === 'expression' ? '💬' : ability === 'logic' ? '🧠' : ability === 'creativity' ? '🎨' : '🔍'}</div>
                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">${abilityName}专家</div>
                            <div style="font-size: 12px; opacity: 0.9;">完成所有${abilityName}基础训练</div>
                        </div>
                    </div>
                    
                    <!-- 下一步建议 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 12px;">💡 下一步建议</h3>
                        <p style="color: #666; font-size: 14px; line-height: 1.5;">
                            ${getNextStepAdvice(ability)}
                        </p>
                    </div>
                    
                    <!-- 操作选择 -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <button onclick="exploreOtherAbilities()" style="background: #007AFF; color: white; border: none; padding: 20px; border-radius: 12px; cursor: pointer; font-weight: 600; text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 8px;">🎯</div>
                            <div style="font-size: 16px; margin-bottom: 4px;">探索其他能力</div>
                            <div style="font-size: 12px; opacity: 0.9;">训练更多技能</div>
                        </button>
                        
                        <button onclick="chatWithAI()" style="background: #34d399; color: white; border: none; padding: 20px; border-radius: 12px; cursor: pointer; font-weight: 600; text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 8px;">🤖</div>
                            <div style="font-size: 16px; margin-bottom: 4px;">与AI助教聊天</div>
                            <div style="font-size: 12px; opacity: 0.9;">获得更多指导</div>
                        </button>
                        
                        <button onclick="shareAchievement()" style="background: #f59e0b; color: white; border: none; padding: 20px; border-radius: 12px; cursor: pointer; font-weight: 600; text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 8px;">📤</div>
                            <div style="font-size: 16px; margin-bottom: 4px;">分享成就</div>
                            <div style="font-size: 12px; opacity: 0.9;">让朋友看到</div>
                        </button>
                        
                        <button onclick="switchToHomeInterface()" style="background: #8e8e93; color: white; border: none; padding: 20px; border-radius: 12px; cursor: pointer; font-weight: 600; text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 8px;">🏠</div>
                            <div style="font-size: 16px; margin-bottom: 4px;">返回首页</div>
                            <div style="font-size: 12px; opacity: 0.9;">查看总体进度</div>
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 获取下一步建议
        function getNextStepAdvice(ability) {
            const advice = {
                expression: '你的表达能力有了很大提升！建议接下来可以尝试逻辑力训练，这样能让你的表达更有条理性。也可以多参与故事墙的创作分享，锻炼实际表达能力。',
                logic: '逻辑思维能力增强了！建议结合创造力训练，让你的想法既有逻辑又有创意。还可以多做一些探究性的问题分析，提升综合思维能力。',
                creativity: '创造力表现很棒！建议将创意与表达力结合，多在故事墙分享你的创作。也可以尝试探究力训练，为创意提供更多科学依据。',
                exploration: '探究精神很强！建议将探究发现与创造力结合，设计更多有趣的实验。也可以提升表达力，更好地分享你的探究成果。'
            };
            
            return advice[ability] || '继续保持学习热情，探索更多有趣的知识领域！';
        }
        
        // 下一步操作函数
        function exploreOtherAbilities() {
            showNotification('🎯 正在为你推荐其他能力训练...');
            setTimeout(() => {
                switchToTrainingInterface();
            }, 1500);
        }
        
        function chatWithAI() {
            showNotification('🤖 正在连接AI助教...');
            setTimeout(() => {
                switchToAIInterface();
            }, 1500);
        }
        
        function shareAchievement() {
            showNotification('📤 成就分享成功！你的朋友们会看到你的学习成果！');
            setTimeout(() => {
                showNotification('🎉 分享获得额外经验值+2！');
            }, 2000);
        }
        
        // 获取学习建议
        function getLearningAdvice(ability, taskIndex) {
            const advice = {
                expression: [
                    '继续练习描述技巧，可以多观察身边的事物，用丰富的词汇来形容。建议每天练习描述一样新事物。',
                    '故事复述能力很好！可以尝试复述更复杂的故事，注意保持故事的逻辑性和完整性。',
                    '情感表达很到位！可以在日常生活中多练习，用表情和动作来增强语言的表现力。',
                    '演讲技巧不错！建议多练习在不同场合的表达，提升自信心和表达的感染力。'
                ],
                logic: [
                    '逻辑推理能力很强！可以多做一些类似的推理题，锻炼严密的思维能力。',
                    '数学思维敏捷！建议多接触不同类型的数学规律题，提升抽象思维能力。',
                    '问题分析很深入！可以多关注生活中的现象，培养科学思维和探究精神。',
                    '因果关系理解正确！建议多观察自然现象，思考事物之间的联系。'
                ],
                creativity: [
                    '想象力很丰富！可以多画画、多创作，把想象变成具体的作品。',
                    '故事创作很有天赋！建议多读优秀的故事，学习不同的写作技巧。',
                    '发明创意很棒！可以多观察生活中的问题，思考创新的解决方案。',
                    '想象表达很独特！建议多与朋友分享你的想法，激发更多创意火花。'
                ],
                exploration: [
                    '观察能力很强！建议多做科学小实验，培养严谨的科学态度。',
                    '实验探究很认真！可以尝试更多有趣的实验，探索科学的奥秘。',
                    '提问质量很高！好奇心是学习的动力，继续保持对世界的好奇。',
                    '假设验证很科学！建议多思考生活中的现象，用科学方法验证想法。'
                ]
            };
            
            return advice[ability][taskIndex] || '继续保持学习热情，你的表现很棒！';
        }
        
        // 获取AI反馈
        function getAIFeedback(ability, taskIndex) {
            const feedback = {
                expression: [
                    '语言表达清晰，描述生动有趣！',
                    '故事复述完整，语言组织很好！',
                    '情感表达丰富，表演很到位！',
                    '演讲内容有条理，声音洪亮！'
                ],
                logic: [
                    '逻辑推理准确，思路清晰！',
                    '数学思维敏捷，找规律很棒！',
                    '问题分析深入，思考全面！',
                    '因果关系理解正确，逻辑性强！'
                ],
                creativity: [
                    '想象力丰富，创意十足！',
                    '故事情节有趣，创新性强！',
                    '发明设计实用，很有创意！',
                    '想象表达独特，思维活跃！'
                ],
                exploration: [
                    '观察仔细，科学态度很好！',
                    '实验操作规范，探索精神强！',
                    '提问质量高，好奇心强！',
                    '假设合理，验证方法正确！'
                ]
            };
            
            return feedback[ability][taskIndex] || '表现很棒，继续加油！';
        }
        
        // AI聊天功能
        function sendQuickAIMessage(message) {
            addChatMessage(message, 'user');
            
            setTimeout(() => {
                let response = '';
                if (message.includes('进度')) {
                    response = '你的学习进度很棒！表达力65点，创造力80点，已经是小专家了！继续保持这种学习热情！';
                } else if (message.includes('小芽芽')) {
                    response = '小芽芽现在Lv.4，很开心！它的成长值580，活跃度420，想和你一起学习呢！';
                } else if (message.includes('学习')) {
                    response = '太好了！根据你的情况，我建议你可以加强逻辑力训练，现在45点还有提升空间。要开始吗？';
                } else if (message.includes('故事')) {
                    response = '好的！我来给你讲一个故事：从前有一只勇敢的小兔子，它有一个梦想就是成为森林里最会讲故事的动物...';
                }
                addChatMessage(response, 'ai');
            }, 1500);
        }
        
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;
            
            sendQuickAIMessage(message);
            input.value = '';
        }
        
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }
        
        function addChatMessage(message, sender) {
            const chatArea = document.getElementById('chatMessages');
            const messageEl = document.createElement('div');
            messageEl.style.marginBottom = '12px';
            
            if (sender === 'user') {
                messageEl.innerHTML = `
                    <div style="display: flex; justify-content: flex-end;">
                        <div style="background: #007AFF; color: white; padding: 12px 16px; border-radius: 18px; max-width: 70%; font-size: 14px;">
                            ${message}
                        </div>
                    </div>
                `;
            } else {
                messageEl.innerHTML = `
                    <div style="display: flex; justify-content: flex-start;">
                        <div style="background: white; color: #1d1d1f; padding: 12px 16px; border-radius: 18px; max-width: 70%; box-shadow: 0 1px 3px rgba(0,0,0,0.1); font-size: 14px;">
                            ${message}
                        </div>
                    </div>
                `;
            }
            
            chatArea.appendChild(messageEl);
            chatArea.scrollTop = chatArea.scrollHeight;
        }
        
        // 伙伴互动功能
        function partnerBigInteraction() {
            showNotification('🌳 小芽芽：主人！我现在是智慧树了，我们一起学更多知识吧！');
        }
        
        function feedPartnerBig() {
            showNotification('🍯 小芽芽：谢谢主人！我更有活力了！成长值+25');
        }
        
        function playWithPartnerBig() {
            showNotification('🎮 小芽芽：和主人玩游戏最开心了！活跃度+30');
        }
        
        function decoratePartnerBig() {
            showNotification('🎨 小芽芽：我戴上了新帽子！谢谢主人！');
        }
        
        // 故事发布功能
        function openStoryPublish() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="switchToStoryInterface()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回故事墙
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">发布新故事</h2>
                    </div>
                    
                    <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-size: 14px; font-weight: 600; color: #1d1d1f; margin-bottom: 8px;">故事标题</label>
                            <input type="text" id="storyTitle" placeholder="给你的故事起个好听的名字..." style="width: 100%; padding: 12px 16px; border: 1px solid #e5e5ea; border-radius: 8px; font-size: 16px; outline: none;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-size: 14px; font-weight: 600; color: #1d1d1f; margin-bottom: 8px;">故事内容</label>
                            <textarea id="storyContent" placeholder="在这里写下你的精彩故事..." style="width: 100%; height: 120px; padding: 12px 16px; border: 1px solid #e5e5ea; border-radius: 8px; font-size: 14px; resize: none; outline: none; line-height: 1.5;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-size: 14px; font-weight: 600; color: #1d1d1f; margin-bottom: 8px;">故事类型</label>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button onclick="selectStoryType('adventure', this)" class="story-type-btn" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 6px 12px; border-radius: 12px; font-size: 12px; cursor: pointer;">🏔️ 冒险</button>
                                <button onclick="selectStoryType('fairy', this)" class="story-type-btn" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 6px 12px; border-radius: 12px; font-size: 12px; cursor: pointer;">🧚 童话</button>
                                <button onclick="selectStoryType('science', this)" class="story-type-btn" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 6px 12px; border-radius: 12px; font-size: 12px; cursor: pointer;">🔬 科幻</button>
                                <button onclick="selectStoryType('daily', this)" class="story-type-btn" style="background: #f2f2f7; border: 1px solid #e5e5ea; padding: 6px 12px; border-radius: 12px; font-size: 12px; cursor: pointer;">📝 日常</button>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button onclick="switchToStoryInterface()" style="background: #8e8e93; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">取消</button>
                            <button onclick="publishNewStory()" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">📝 发布故事</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // 选择故事类型
        function selectStoryType(type, element) {
            // 重置所有按钮样式
            document.querySelectorAll('.story-type-btn').forEach(btn => {
                btn.style.background = '#f2f2f7';
                btn.style.color = '#1d1d1f';
                btn.style.borderColor = '#e5e5ea';
            });
            
            // 高亮选中的按钮
            element.style.background = '#007AFF';
            element.style.color = 'white';
            element.style.borderColor = '#007AFF';
            
            showNotification(`已选择故事类型：${type === 'adventure' ? '冒险' : type === 'fairy' ? '童话' : type === 'science' ? '科幻' : '日常'}`);
        }
        
        // 发布新故事
        function publishNewStory() {
            const title = document.getElementById('storyTitle').value.trim();
            const content = document.getElementById('storyContent').value.trim();
            
            if (!title || !content) {
                showNotification('⚠️ 请填写故事标题和内容');
                return;
            }
            
            showNotification('📝 正在发布故事...');
            
            setTimeout(() => {
                showNotification('🤖 AI正在分析你的故事...');
            }, 1500);
            
            setTimeout(() => {
                showNotification('🎉 故事发布成功！AI评分：92分');
            }, 3000);
            
            setTimeout(() => {
                showNotification('🏆 恭喜获得"故事创作家"成就！');
                switchToStoryInterface();
            }, 4500);
        }
        
        // 共创功能
        function openCollaboration() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="switchToStoryInterface()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回故事墙
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">共创故事</h2>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #34d399 0%, #10b981 100%); color: white; border-radius: 16px; padding: 24px; margin-bottom: 20px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 16px;">🤝</div>
                        <h3 style="margin-bottom: 8px;">多人协作故事创作</h3>
                        <p style="opacity: 0.9; font-size: 14px;">与其他小朋友一起创作精彩故事</p>
                    </div>
                    
                    <!-- 当前共创故事 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                            <h3 style="color: #1d1d1f;">《森林大冒险》</h3>
                            <div style="display: flex; gap: 8px;">
                                <div style="background: #e8f5e8; color: #388e3c; padding: 4px 8px; border-radius: 6px; font-size: 11px;">进行中</div>
                                <div style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 6px; font-size: 11px;">3人参与</div>
                            </div>
                        </div>
                        
                        <div style="background: #f8fafc; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                            <div style="font-size: 14px; line-height: 1.6; color: #374151;">
                                <div style="margin-bottom: 8px;"><strong>小明:</strong> 在一个阳光明媚的早晨，小熊决定去森林探险。它背着小背包，带着放大镜和指南针...</div>
                                <div style="margin-bottom: 8px;"><strong>小红:</strong> 突然，小熊听到了奇怪的声音，它小心翼翼地走向声音来源。原来是一只受伤的小鸟在树下...</div>
                                <div style="color: #007AFF; font-style: italic;">等待下一位小朋友续写...</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-size: 14px; font-weight: 600; color: #1d1d1f; margin-bottom: 8px;">续写故事</label>
                            <textarea id="collaborationContent" placeholder="接下来会发生什么呢？发挥你的想象力..." style="width: 100%; height: 80px; padding: 12px 16px; border: 1px solid #e5e5ea; border-radius: 8px; font-size: 14px; resize: none; outline: none;"></textarea>
                        </div>
                        
                        <button onclick="submitCollaboration()" style="background: #34d399; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%;">
                            ✏️ 提交续写
                        </button>
                    </div>
                    
                    <!-- 创建新的共创故事 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 16px;">🆕 发起新的共创故事</h3>
                        <div style="margin-bottom: 16px;">
                            <input type="text" id="newCollabTitle" placeholder="共创故事标题..." style="width: 100%; padding: 12px 16px; border: 1px solid #e5e5ea; border-radius: 8px; font-size: 14px; outline: none; margin-bottom: 12px;">
                            <textarea id="newCollabStart" placeholder="写下故事的开头，让其他小朋友接着创作..." style="width: 100%; height: 80px; padding: 12px 16px; border: 1px solid #e5e5ea; border-radius: 8px; font-size: 14px; resize: none; outline: none;"></textarea>
                        </div>
                        <button onclick="createNewCollaboration()" style="background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%;">
                            🚀 创建共创故事
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 参与共创
        function joinCollaboration() {
            showNotification('✏️ 正在进入共创模式...');
            setTimeout(() => {
                openCollaboration();
            }, 1000);
        }
        
        // 提交共创内容
        function submitCollaboration() {
            const content = document.getElementById('collaborationContent').value.trim();
            
            if (!content) {
                showNotification('⚠️ 请输入续写内容');
                return;
            }
            
            showNotification('📝 正在提交续写内容...');
            
            setTimeout(() => {
                showNotification('🤖 AI正在审核你的续写...');
            }, 1500);
            
            setTimeout(() => {
                showNotification('✅ 续写提交成功！等待其他小朋友继续创作');
            }, 3000);
            
            setTimeout(() => {
                showNotification('🎉 你的续写很精彩！获得创作经验+10');
                switchToStoryInterface();
            }, 4500);
        }
        
        // 创建新共创故事
        function createNewCollaboration() {
            const title = document.getElementById('newCollabTitle').value.trim();
            const startContent = document.getElementById('newCollabStart').value.trim();
            
            if (!title || !startContent) {
                showNotification('⚠️ 请填写故事标题和开头内容');
                return;
            }
            
            showNotification('🚀 正在创建共创故事...');
            
            setTimeout(() => {
                showNotification('🤖 AI正在分析故事开头...');
            }, 1500);
            
            setTimeout(() => {
                showNotification('✅ 共创故事创建成功！邀请朋友们一起创作吧');
            }, 3000);
            
            setTimeout(() => {
                showNotification('🎊 恭喜获得"共创发起人"成就！');
                switchToStoryInterface();
            }, 4500);
        }
        
        // 故事互动
        function likeStoryDetail() {
            const likeBtn = event.currentTarget;
            const countEl = document.getElementById('likeCount');
            const currentCount = parseInt(countEl.textContent);
            countEl.textContent = currentCount + 1;
            likeBtn.style.color = '#ff3b30';
            showNotification('❤️ 已为故事点赞！');
        }
        
        function likeStorySecond() {
            const countEl = document.getElementById('likeCount2');
            const currentCount = parseInt(countEl.textContent);
            countEl.textContent = currentCount + 1;
            showNotification('❤️ 已为《神奇的花园》点赞！');
        }
        
        function commentStory() {
            showNotification('💬 评论功能：这个故事真精彩！我也想写一个！');
        }
        
        function shareStoryDetail() {
            showNotification('📤 故事分享成功！你的朋友们会看到这个精彩故事！');
        }
        
        // 成就展示
        function showAchievement(achievementId) {
            const achievements = {
                'creative-master': '🎨 创意大师\n\n创造力达到80点\n获得时间：刚刚\n\n你的想象力和创新能力非常出色！',
                'expression-expert': '💬 表达专家\n\n表达力达到60点\n获得时间：2天前\n\n你的语言表达能力很棒！',
                'streak-champion': '🔥 坚持冠军\n\n连续学习5天\n获得时间：今天\n\n坚持就是胜利！'
            };
            
            alert(achievements[achievementId] || '成就详情');
        }
        
        // ===== 添加首页缺失的功能函数 =====
        
        // 能力训练入口
        function openAbilityTraining(ability) {
            const abilityNames = {
                expression: '表达力',
                logic: '逻辑力',
                creativity: '创造力',
                exploration: '探究力'
            };
            
            const abilityName = abilityNames[ability];
            showNotification(`🎯 开始${abilityName}训练...`);
            
            // 模拟训练过程
            setTimeout(() => {
                showNotification(`🚀 ${abilityName}训练进行中...`);
            }, 1000);
            
            setTimeout(() => {
                showNotification(`🤖 AI反馈：${abilityName}有明显提升！`);
            }, 2500);
            
            setTimeout(() => {
                showNotification(`🎉 训练完成！${abilityName}+15，获得经验值！`);
            }, 4000);
        }
        
        // 虚拟伙伴互动
        function interactWithPartner() {
            showNotification('🌳 小芽芽：主人！我现在是智慧树了，我们一起学习吧！');
        }
        
        function partnerBigInteraction() {
            showNotification('🌳 小芽芽静静地等待着，只有通过学习训练才能帮助它成长哦！');
        }
        
        // 添加CSS动画
        const additionalStyles = document.createElement('style');
        additionalStyles.textContent = `
            @keyframes bounce {
                0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                40% { transform: translateY(-10px); }
                60% { transform: translateY(-5px); }
            }
        `;
        document.head.appendChild(additionalStyles);
        
        // ===== AI测评系统实现 =====
        
        let assessmentData = {
            currentQuestion: 0,
            answers: [],
            abilities: {
                expression: 0,
                logic: 0,
                creativity: 0,
                exploration: 0,
                habit: 0
            }
        };
        
        // 开始AI测评
        function startAIAssessment() {
            assessmentData.currentQuestion = 0;
            assessmentData.answers = [];
            showNotification('🤖 AI测评系统启动中...');
            
            setTimeout(() => {
                showAssessmentQuestion();
            }, 1500);
        }
        
        // 显示测评问题
        function showAssessmentQuestion() {
            const questions = [
                {
                    type: 'expression',
                    question: '当你看到一只可爱的小猫时，你会怎么描述它？',
                    options: [
                        { text: '小猫很可爱', points: 1 },
                        { text: '这只小猫有着雪白的毛发，圆圆的眼睛，正在优雅地舔着爪子', points: 3 },
                        { text: '猫', points: 0 },
                        { text: '这只小猫看起来很温顺，它的毛很软，眼睛亮晶晶的', points: 2 }
                    ],
                    subject: '语文学科 - 词汇运用与描述能力'
                },
                {
                    type: 'logic',
                    question: '如果今天下雨，小明就不去公园。今天小明去了公园，那么今天的天气怎么样？',
                    options: [
                        { text: '今天没有下雨', points: 3 },
                        { text: '今天下雨了', points: 0 },
                        { text: '不知道', points: 1 },
                        { text: '可能下雨也可能不下雨', points: 1 }
                    ],
                    subject: '数学学科 - 逻辑推理与条件判断'
                },
                {
                    type: 'creativity',
                    question: '如果你是一朵云，你最想变成什么形状？',
                    options: [
                        { text: '小兔子，这样就能和地上的小朋友一起玩耍', points: 3 },
                        { text: '圆形', points: 1 },
                        { text: '一座城堡，里面住着云朵公主和彩虹王子', points: 3 },
                        { text: '不知道', points: 0 }
                    ],
                    subject: '美术学科 - 想象力与创意表达'
                },
                {
                    type: 'exploration',
                    question: '看到一个新的玩具，你第一个想法是什么？',
                    options: [
                        { text: '这个玩具是怎么做的？', points: 3 },
                        { text: '好想要这个玩具', points: 1 },
                        { text: '它能做什么？可以怎么玩？', points: 2 },
                        { text: '没什么特别的', points: 0 }
                    ],
                    subject: '科学学科 - 观察能力与探究精神'
                },
                {
                    type: 'habit',
                    question: '你平时是怎么安排学习时间的？',
                    options: [
                        { text: '有固定的学习时间，会制定计划', points: 3 },
                        { text: '想起来就学习', points: 1 },
                        { text: '妈妈提醒才学习', points: 1 },
                        { text: '会设定学习目标，完成后奖励自己', points: 3 }
                    ],
                    subject: '综合素养 - 自主学习与时间管理'
                }
            ];
            
            const currentQ = questions[assessmentData.currentQuestion];
            if (!currentQ) {
                // 测评完成
                completeAssessment();
                return;
            }
            
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #007AFF; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                ${assessmentData.currentQuestion + 1}
                            </div>
                            <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">AI能力测评</h2>
                        </div>
                        <div style="font-size: 14px; color: #8e8e93;">
                            ${assessmentData.currentQuestion + 1}/${questions.length}
                        </div>
                    </div>
                    
                    <!-- 进度条 -->
                    <div style="background: #e5e5ea; height: 6px; border-radius: 3px; margin-bottom: 24px; overflow: hidden;">
                        <div style="background: #007AFF; height: 100%; width: ${((assessmentData.currentQuestion + 1) / questions.length) * 100}%; border-radius: 3px; transition: width 0.5s ease;"></div>
                    </div>
                    
                    <!-- AI学科标识 -->
                    <div style="background: #f0f9ff; border: 1px solid #e0f2fe; border-radius: 8px; padding: 12px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="background: #007AFF; color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600;">AI分析</span>
                            <span style="color: #0369a1; font-size: 12px;">${currentQ.subject}</span>
                        </div>
                    </div>
                    
                    <!-- 问题内容 -->
                    <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <div style="font-size: 32px;">${currentQ.type === 'expression' ? '💬' : currentQ.type === 'logic' ? '🧠' : currentQ.type === 'creativity' ? '🎨' : currentQ.type === 'exploration' ? '🔍' : '⏰'}</div>
                            <div>
                                <div style="font-size: 14px; color: #007AFF; font-weight: 600;">${currentQ.type === 'expression' ? '表达力测评' : currentQ.type === 'logic' ? '逻辑力测评' : currentQ.type === 'creativity' ? '创造力测评' : currentQ.type === 'exploration' ? '探究力测评' : '习惯力测评'}</div>
                            </div>
                        </div>
                        <h3 style="color: #1d1d1f; margin-bottom: 20px; font-size: 18px; line-height: 1.4;">${currentQ.question}</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                            ${currentQ.options.map((option, index) => `
                                <button onclick="selectAssessmentAnswer(${index}, ${option.points})" style="background: #f8fafc; border: 2px solid #e5e5ea; padding: 16px; border-radius: 12px; cursor: pointer; text-align: left; transition: all 0.3s ease; font-size: 14px; line-height: 1.4;" onmouseover="this.style.borderColor='#007AFF'; this.style.background='#f0f9ff'" onmouseout="this.style.borderColor='#e5e5ea'; this.style.background='#f8fafc'">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="background: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #007AFF;">
                                            ${String.fromCharCode(65 + index)}
                                        </div>
                                        <span>${option.text}</span>
                                    </div>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- AI提示 -->
                    <div style="background: #e8f5e8; border-radius: 8px; padding: 12px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 16px;">🤖</span>
                            <span style="color: #388e3c; font-size: 12px; font-weight: 600;">AI提示：没有标准答案，选择最符合你想法的选项即可</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // 选择测评答案
        function selectAssessmentAnswer(optionIndex, points) {
            // 记录答案
            assessmentData.answers.push({
                questionIndex: assessmentData.currentQuestion,
                optionIndex: optionIndex,
                points: points
            });
            
            // 更新能力分数
            const questions = [
                { type: 'expression' },
                { type: 'logic' },
                { type: 'creativity' },
                { type: 'exploration' },
                { type: 'habit' }
            ];
            
            const currentType = questions[assessmentData.currentQuestion].type;
            assessmentData.abilities[currentType] += points * 10; // 放大分数
            
            showNotification('🤖 AI正在分析你的答案...');
            
            // 下一题
            setTimeout(() => {
                assessmentData.currentQuestion++;
                showAssessmentQuestion();
            }, 1500);
        }
        
        // 完成测评
        function completeAssessment() {
            showNotification('🤖 AI正在生成你的个性化学习方案...');
            
            setTimeout(() => {
                showAssessmentResults();
            }, 3000);
        }
        
        // 显示测评结果
        function showAssessmentResults() {
            // 保存测评完成状态
            localStorage.setItem('mengya_assessment_completed', 'true');
            
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="font-size: 64px; margin-bottom: 16px;">🎯</div>
                        <h2 style="font-size: 24px; font-weight: 700; color: #1d1d1f; margin-bottom: 8px;">AI测评完成！</h2>
                        <p style="color: #8e8e93; font-size: 16px;">AI已为你生成专属学习方案</p>
                    </div>
                    
                    <!-- AI分析结果 -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 24px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <div style="font-size: 32px;">🤖</div>
                            <div>
                                <h3 style="margin-bottom: 4px;">AI智能分析报告</h3>
                                <p style="opacity: 0.9; font-size: 14px;">基于学科内容的个性化能力评估</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                            ${Object.entries(assessmentData.abilities).map(([ability, score]) => {
                                const abilityNames = {
                                    expression: '表达力',
                                    logic: '逻辑力',
                                    creativity: '创造力',
                                    exploration: '探究力',
                                    habit: '习惯力'
                                };
                                const level = score >= 25 ? '优秀' : score >= 15 ? '良好' : score >= 5 ? '一般' : '待提升';
                                const color = score >= 25 ? '#34d399' : score >= 15 ? '#f59e0b' : score >= 5 ? '#007AFF' : '#ff3b30';
                                
                                return `
                                    <div style="background: rgba(255, 255, 255, 0.15); padding: 12px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">${abilityNames[ability]}</div>
                                        <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px; color: ${color};">${score}分</div>
                                        <div style="font-size: 11px; opacity: 0.9;">${level}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- AI生成的学习路径 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <span style="background: #007AFF; color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600;">AI生成</span>
                            <h3 style="color: #1d1d1f;">个性化学习路径</h3>
                        </div>
                        
                        <div id="aiGeneratedPath" style="color: #666; font-size: 14px; line-height: 1.6;">
                            ${generatePersonalizedPath(assessmentData.abilities)}
                        </div>
                    </div>
                    
                    <!-- AI学科内容匹配 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <span style="background: #34d399; color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600;">学科融合</span>
                            <h3 style="color: #1d1d1f;">AI推荐学习内容</h3>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                            ${generateSubjectContent(assessmentData.abilities)}
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="enterMainApp()" style="background: #007AFF; color: white; border: none; padding: 16px 32px; border-radius: 25px; cursor: pointer; font-weight: 600; font-size: 18px; box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);">
                            🚀 开始个性化学习
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 生成个性化学习路径
        function generatePersonalizedPath(abilities) {
            const strongest = Object.entries(abilities).reduce((a, b) => abilities[a[0]] > abilities[b[0]] ? a : b);
            const weakest = Object.entries(abilities).reduce((a, b) => abilities[a[0]] < abilities[b[0]] ? a : b);
            
            const abilityNames = {
                expression: '表达力',
                logic: '逻辑力',
                creativity: '创造力',
                exploration: '探究力',
                habit: '习惯力'
            };
            
            return `
                基于AI分析，你的<strong>${abilityNames[strongest[0]]}</strong>表现最好(${strongest[1]}分)，<strong>${abilityNames[weakest[0]]}</strong>还有提升空间(${weakest[1]}分)。
                <br><br>
                <strong>🎯 AI推荐学习路径：</strong><br>
                1. 先从${abilityNames[weakest[0]]}开始，建立基础信心<br>
                2. 结合你的${abilityNames[strongest[0]]}优势，进行综合训练<br>
                3. 逐步平衡发展其他能力<br>
                4. 定期进行AI评估，调整学习方向
            `;
        }
        
        // 生成学科内容
        function generateSubjectContent(abilities) {
            const subjectMapping = [
                {
                    icon: '📖',
                    subject: '语文融合内容',
                    content: '基于你的表达力水平，AI生成古诗词朗诵、看图写话、故事创作等内容',
                    aiGenerated: true
                },
                {
                    icon: '🔢',
                    subject: '数学融合内容', 
                    content: '结合逻辑力评估，AI定制数学游戏、逻辑推理、空间思维等训练',
                    aiGenerated: true
                },
                {
                    icon: '🔬',
                    subject: '科学融合内容',
                    content: '基于探究力分析，AI推荐科学实验、自然观察、科普故事等内容',
                    aiGenerated: true
                },
                {
                    icon: '🎨',
                    subject: '艺术融合内容',
                    content: '依据创造力水平，AI生成绘画创作、音乐律动、手工制作等活动',
                    aiGenerated: true
                }
            ];
            
            return subjectMapping.map(item => `
                <div style="background: #f8fafc; border-radius: 8px; padding: 16px; border-left: 4px solid #667eea;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                        <span style="font-size: 20px;">${item.icon}</span>
                        <div>
                            <div style="font-size: 14px; font-weight: 600; color: #1d1d1f;">${item.subject}</div>
                            ${item.aiGenerated ? '<div style="background: #667eea; color: white; padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: 600; display: inline-block; margin-top: 2px;">AI生成</div>' : ''}
                        </div>
                    </div>
                    <p style="color: #666; font-size: 12px; line-height: 1.4;">${item.content}</p>
                </div>
            `).join('');
        }
        
        // 跳过测评
        function skipAssessment() {
            showNotification('⚠️ 跳过测评将使用默认学习方案');
            
            setTimeout(() => {
                // 标记测评已完成（跳过也算完成）
                sessionStorage.setItem('session_assessment_completed', 'true');
                localStorage.setItem('mengya_assessment_completed', 'true');
                
                // 直接进入主界面
                initializeMainInterface();
                showWelcomeNotification();
            }, 2000);
        }
        
        // 进入主应用
        function enterMainApp() {
            showNotification('🎯 正在应用AI分析结果，生成你的专属内容...');
            
            // 保存AI测评结果到用户数据
            setTimeout(() => {
                initializeAppDataWithAssessment();
                showNotification('✅ 个性化学习环境已准备就绪！');
                
                setTimeout(() => {
                    // 标记当前会话已完成测评
                    sessionStorage.setItem('session_assessment_completed', 'true');
                    localStorage.setItem('mengya_assessment_completed', 'true');
                    
                    // 直接进入主界面，不重新加载页面
                    initializeMainInterface();
                    showWelcomeNotification();
                }, 2000);
            }, 2000);
        }
        
        // 基于测评结果初始化数据
        function initializeAppDataWithAssessment() {
            // 根据测评结果调整初始数据
            const baseData = {
                profile: {
                    nickname: '小明',
                    avatar: '👦',
                    level: 1,
                    experience: 0,
                    joinDate: new Date().toISOString(),
                    assessmentCompleted: true,
                    aiGeneratedPath: true
                },
                progress: {
                    totalTasks: 0,
                    completedTasks: 0,
                    currentStreak: 0,
                    maxStreak: 0,
                    abilities: assessmentData.abilities, // 使用测评结果
                    aiRecommendations: generateAIRecommendations(assessmentData.abilities)
                }
            };
            
            // 保存到localStorage
            Object.entries(baseData).forEach(([key, value]) => {
                localStorage.setItem(`mengya_child.${key}`, JSON.stringify(value));
            });
        }
        
        // 生成AI推荐
        function generateAIRecommendations(abilities) {
            const weakestAbility = Object.entries(abilities).reduce((a, b) => abilities[a[0]] < abilities[b[0]] ? a : b);
            const strongestAbility = Object.entries(abilities).reduce((a, b) => abilities[a[0]] > abilities[b[0]] ? a : b);
            
            return {
                priorityAbility: weakestAbility[0],
                strengthAbility: strongestAbility[0],
                suggestedOrder: [weakestAbility[0], strongestAbility[0]],
                aiGenerated: true,
                timestamp: new Date().toISOString()
            };
        }
        
        // ===== 修复Tab切换中缺失的函数 =====
        
        function showLearningContent() {
            switchToTrainingInterface();
        }
        
        function showAIContent() {
            switchToAIInterface();
        }
        
        function showStoryContent() {
            switchToStoryInterface();
        }
        
        function showProfileContent() {
            switchToProfileInterface();
        }
        
        // ===== 家长端功能实现 =====
        
        function openParentPortal() {
            // 首先显示家长验证
            showParentAuth();
        }
        
        function showParentAuth() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 40px; text-align: center;">
                    <div style="font-size: 64px; margin-bottom: 20px;">🔐</div>
                    <h2 style="font-size: 24px; font-weight: 700; color: #1d1d1f; margin-bottom: 12px;">家长身份验证</h2>
                    <p style="color: #8e8e93; font-size: 16px; margin-bottom: 32px;">
                        请验证家长身份以访问学习监控和分析功能
                    </p>
                    
                    <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 300px; margin: 0 auto 24px;">
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; text-align: left;">验证密码</label>
                            <input type="password" id="parentPassword" placeholder="请输入家长密码" style="width: 100%; padding: 12px 16px; border: 1px solid #e5e5ea; border-radius: 8px; font-size: 16px; outline: none;">
                        </div>
                        <div style="font-size: 12px; color: #8e8e93; margin-bottom: 16px;">
                            演示密码：<code style="background: #f2f2f7; padding: 2px 4px; border-radius: 4px;">123456</code>
                        </div>
                        <button onclick="verifyParentAccess()" style="background: #007AFF; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%;">
                            验证并进入
                        </button>
                    </div>
                    
                    <button onclick="switchTab('home')" style="background: #8e8e93; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                        返回儿童模式
                    </button>
                </div>
            `;
        }
        
        function verifyParentAccess() {
            const password = document.getElementById('parentPassword').value;
            
            if (password === '123456') {
                showNotification('✅ 验证成功！正在进入家长端...');
                setTimeout(() => {
                    showParentDashboard();
                }, 1500);
            } else {
                showNotification('❌ 密码错误，请重试');
            }
        }
        
        function showParentDashboard() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;">
                        <div>
                            <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">家长控制面板</h2>
                            <p style="color: #8e8e93; font-size: 14px;">小明的学习数据分析</p>
                        </div>
                        <button onclick="switchTab('home')" style="background: #8e8e93; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                            返回儿童模式
                        </button>
                    </div>
                    
                    <!-- AI学习分析报告 -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 24px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <div style="font-size: 32px;">🤖</div>
                            <div>
                                <h3 style="margin-bottom: 4px;">AI智能学习报告</h3>
                                <p style="opacity: 0.9; font-size: 14px;">基于7天学习数据的深度分析</p>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 16px;">
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">5.2小时</div>
                                    <div style="font-size: 11px; opacity: 0.9;">本周学习时长</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">12个</div>
                                    <div style="font-size: 11px; opacity: 0.9;">完成任务数</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">92%</div>
                                    <div style="font-size: 11px; opacity: 0.9;">学习专注度</div>
                                </div>
                            </div>
                            
                            <div style="border-top: 1px solid rgba(255, 255, 255, 0.2); padding-top: 12px;">
                                <div style="font-size: 13px; font-weight: 600; margin-bottom: 4px;">🎯 AI分析结论：</div>
                                <div style="font-size: 12px; opacity: 0.9; line-height: 1.4;">
                                    孩子学习态度积极，创造力表现突出(80分)，建议加强逻辑力训练。
                                    学习专注度高，建议保持当前学习节奏。
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 能力发展趋势 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                            <h3 style="color: #1d1d1f;">📈 能力发展趋势</h3>
                            <div style="display: flex; gap: 8px;">
                                <span style="background: #007AFF; color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px;">AI分析</span>
                                <span style="color: #8e8e93; font-size: 12px;">最近7天</span>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span>💬 表达力</span>
                                    <div style="background: #34d399; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">↗️ +15</div>
                                </div>
                                <div style="font-size: 14px; font-weight: 600; color: #34d399;">65分</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span>🎨 创造力</span>
                                    <div style="background: #34d399; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">↗️ +20</div>
                                </div>
                                <div style="font-size: 14px; font-weight: 600; color: #34d399;">80分</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span>🧠 逻辑力</span>
                                    <div style="background: #f59e0b; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">→ +5</div>
                                </div>
                                <div style="font-size: 14px; font-weight: 600; color: #f59e0b;">45分</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 学习行为分析 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 16px;">🧠 AI行为分析</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                            <div style="background: #e8f5e8; border-radius: 8px; padding: 12px;">
                                <div style="font-size: 12px; color: #388e3c; font-weight: 600; margin-bottom: 4px;">✅ 学习习惯良好</div>
                                <div style="font-size: 11px; color: #666;">连续5天保持学习，时间规律性强</div>
                            </div>
                            <div style="background: #fff3e0; border-radius: 8px; padding: 12px;">
                                <div style="font-size: 12px; color: #f57c00; font-weight: 600; margin-bottom: 4px;">⚠️ 需要关注</div>
                                <div style="font-size: 11px; color: #666;">逻辑力训练参与度较低，建议引导</div>
                            </div>
                            <div style="background: #e3f2fd; border-radius: 8px; padding: 12px;">
                                <div style="font-size: 12px; color: #1976d2; font-weight: 600; margin-bottom: 4px;">💡 AI建议</div>
                                <div style="font-size: 11px; color: #666;">可以通过数学游戏提升逻辑思维兴趣</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 家长操作面板 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 16px;">⚙️ 家长控制</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                            <button onclick="exportLearningReport()" style="background: #007AFF; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-weight: 600; text-align: center;">
                                <div style="font-size: 20px; margin-bottom: 4px;">📊</div>
                                <div style="font-size: 12px;">导出学习报告</div>
                            </button>
                            
                            <button onclick="setLearningGoals()" style="background: #34d399; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-weight: 600; text-align: center;">
                                <div style="font-size: 20px; margin-bottom: 4px;">🎯</div>
                                <div style="font-size: 12px;">设置学习目标</div>
                            </button>
                            
                            <button onclick="configureTimeLimit()" style="background: #f59e0b; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-weight: 600; text-align: center;">
                                <div style="font-size: 20px; margin-bottom: 4px;">⏰</div>
                                <div style="font-size: 12px;">时长控制</div>
                            </button>
                            
                            <button onclick="viewAIInsights()" style="background: #667eea; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-weight: 600; text-align: center;">
                                <div style="font-size: 20px; margin-bottom: 4px;">🧠</div>
                                <div style="font-size: 12px;">AI深度洞察</div>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // 导出学习报告
        function exportLearningReport() {
            showNotification('📊 正在生成AI学习报告...');
            
            setTimeout(() => {
                showLearningReport();
            }, 2000);
        }
        
        function showLearningReport() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="showParentDashboard()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回控制面板
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">AI学习分析报告</h2>
                    </div>
                    
                    <!-- 报告头部 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                            <div>
                                <h3 style="color: #1d1d1f; margin-bottom: 4px;">学习者：小明</h3>
                                <p style="color: #8e8e93; font-size: 12px;">报告生成时间：${new Date().toLocaleDateString()}</p>
                            </div>
                            <div style="background: #007AFF; color: white; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 600;">
                                AI生成报告
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                            <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="font-size: 18px; font-weight: 700; color: #007AFF;">Lv.4</div>
                                <div style="font-size: 11px; color: #8e8e93;">当前等级</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="font-size: 18px; font-weight: 700; color: #34d399;">320</div>
                                <div style="font-size: 11px; color: #8e8e93;">总经验值</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="font-size: 18px; font-weight: 700; color: #f59e0b;">5天</div>
                                <div style="font-size: 11px; color: #8e8e93;">连续学习</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="font-size: 18px; font-weight: 700; color: #667eea;">4个</div>
                                <div style="font-size: 11px; color: #8e8e93;">解锁成就</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 能力雷达分析 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 16px;">🎯 五维能力分析</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px;">
                                <span style="font-size: 14px;">💬 表达力</span>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="background: #e5e5ea; width: 100px; height: 6px; border-radius: 3px; overflow: hidden;">
                                        <div style="background: #34d399; height: 100%; width: 65%; border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #34d399; font-weight: 600;">65分</span>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px;">
                                <span style="font-size: 14px;">🧠 逻辑力</span>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="background: #e5e5ea; width: 100px; height: 6px; border-radius: 3px; overflow: hidden;">
                                        <div style="background: #f59e0b; height: 100%; width: 45%; border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #f59e0b; font-weight: 600;">45分</span>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px;">
                                <span style="font-size: 14px;">🎨 创造力</span>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="background: #e5e5ea; width: 100px; height: 6px; border-radius: 3px; overflow: hidden;">
                                        <div style="background: #667eea; height: 100%; width: 80%; border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #667eea; font-weight: 600;">80分</span>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px;">
                                <span style="font-size: 14px;">🔍 探究力</span>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="background: #e5e5ea; width: 100px; height: 6px; border-radius: 3px; overflow: hidden;">
                                        <div style="background: #007AFF; height: 100%; width: 35%; border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #007AFF; font-weight: 600;">35分</span>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px;">
                                <span style="font-size: 14px;">⏰ 习惯力</span>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="background: #e5e5ea; width: 100px; height: 6px; border-radius: 3px; overflow: hidden;">
                                        <div style="background: #34d399; height: 100%; width: 55%; border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #34d399; font-weight: 600;">55分</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI家庭指导建议 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <span style="background: #667eea; color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600;">AI指导</span>
                            <h3 style="color: #1d1d1f;">家庭学习建议</h3>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                            <div style="background: #f0f9ff; border-radius: 8px; padding: 12px;">
                                <div style="font-size: 12px; color: #0369a1; font-weight: 600; margin-bottom: 4px;">📚 学科融合建议</div>
                                <div style="font-size: 11px; color: #666; line-height: 1.4;">
                                    可以在日常对话中融入逻辑思维训练，比如问"为什么"、"怎么样"等问题
                                </div>
                            </div>
                            <div style="background: #f0f9ff; border-radius: 8px; padding: 12px;">
                                <div style="font-size: 12px; color: #0369a1; font-weight: 600; margin-bottom: 4px;">🎯 能力提升建议</div>
                                <div style="font-size: 11px; color: #666; line-height: 1.4;">
                                    建议增加数学类游戏和科学小实验，平衡能力发展
                                </div>
                            </div>
                            <div style="background: #f0f9ff; border-radius: 8px; padding: 12px;">
                                <div style="font-size: 12px; color: #0369a1; font-weight: 600; margin-bottom: 4px;">⏰ 时间安排建议</div>
                                <div style="font-size: 11px; color: #666; line-height: 1.4;">
                                    当前学习时长适中，建议保持每天25-30分钟的学习节奏
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // 家长功能实现
        function setLearningGoals() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="showParentDashboard()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回控制面板
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">学习目标设置</h2>
                    </div>
                    
                    <!-- 家庭陪伴功能入口 -->
                    <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 16px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 12px;">👨‍👩‍👧‍👦 家庭陪伴学习</h3>
                        <p style="opacity: 0.9; font-size: 13px; margin-bottom: 16px;">增强家庭互动，让学习成为全家的快乐时光</p>
                        <div style="display: flex; gap: 12px;">
                            <button onclick="openFamilyTasks()" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                🎯 亲子任务
                            </button>
                            <button onclick="openFamilyStories()" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                📚 家庭共创
                            </button>
                        </div>
                    </div>
                    
                    <!-- 当前目标状态 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 16px;">📊 当前学习目标</h3>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <span>📅 每日学习时长</span>
                                <div style="background: #34d399; color: white; padding: 4px 8px; border-radius: 6px; font-size: 12px;">25分钟/30分钟 ✅</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <span>🎯 每周完成任务</span>
                                <div style="background: #007AFF; color: white; padding: 4px 8px; border-radius: 6px; font-size: 12px;">3个/5个 ⏳</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <span>👨‍👩‍👧‍👦 家庭互动次数</span>
                                <div style="background: #34d399; color: white; padding: 4px 8px; border-radius: 6px; font-size: 12px;">8次/10次 ✅</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // 亲子任务功能
        function openFamilyTasks() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="setLearningGoals()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回目标设置
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">👨‍👩‍👧‍👦 亲子互动任务</h2>
                    </div>
                    
                    <!-- AI推荐亲子任务 -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 24px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <div style="font-size: 32px;">🤖</div>
                            <div>
                                <h3 style="margin-bottom: 4px;">AI智能推荐</h3>
                                <p style="opacity: 0.9; font-size: 14px;">基于小明学习特点的亲子任务</p>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 16px;">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">🎯 本周重点：创造力+逻辑力联合训练</div>
                            <div style="font-size: 12px; opacity: 0.9;">
                                结合小明的创造力优势(80分)，通过亲子互动提升逻辑思维能力(45分)
                            </div>
                        </div>
                    </div>
                    
                    <!-- 今日推荐任务 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <span style="background: #34d399; color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600;">今日推荐</span>
                            <h3 style="color: #1d1d1f;">亲子互动任务</h3>
                        </div>
                        
                        <div class="function-card" onclick="startFamilyTask('story-creation')" style="margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="font-size: 24px;">📚</div>
                                    <div>
                                        <div style="font-size: 16px; font-weight: 600; color: #1d1d1f;">家庭故事创作</div>
                                        <div style="font-size: 12px; color: #8e8e93;">亲子协作 • 20分钟</div>
                                    </div>
                                </div>
                                <div style="background: #34d399; color: white; padding: 4px 8px; border-radius: 6px; font-size: 10px;">推荐</div>
                            </div>
                            <div style="color: #666; font-size: 13px; margin-bottom: 8px;">
                                家长和孩子一起创作故事，锻炼表达力和想象力
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <span style="background: #e3f2fd; color: #0369a1; padding: 4px 8px; border-radius: 6px; font-size: 10px;">语文融合</span>
                                <span style="background: #fce4ec; color: #c2185b; padding: 4px 8px; border-radius: 6px; font-size: 10px;">创造力+表达力</span>
                            </div>
                        </div>
                        
                        <div class="function-card" onclick="startFamilyTask('math-game')" style="margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="font-size: 24px;">🔢</div>
                                    <div>
                                        <div style="font-size: 16px; font-weight: 600; color: #1d1d1f;">数学逻辑游戏</div>
                                        <div style="font-size: 12px; color: #8e8e93;">亲子对战 • 15分钟</div>
                                    </div>
                                </div>
                                <div style="background: #f59e0b; color: white; padding: 4px 8px; border-radius: 6px; font-size: 10px;">重点</div>
                            </div>
                            <div style="color: #666; font-size: 13px; margin-bottom: 8px;">
                                通过趣味数学游戏，在竞技中提升逻辑思维能力
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <span style="background: #e8f5e8; color: #388e3c; padding: 4px 8px; border-radius: 6px; font-size: 10px;">数学融合</span>
                                <span style="background: #e3f2fd; color: #0369a1; padding: 4px 8px; border-radius: 6px; font-size: 10px;">逻辑力</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 家庭学习统计 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 16px;">📈 家庭参与统计</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                            <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="font-size: 18px; font-weight: 700; color: #667eea;">3个</div>
                                <div style="font-size: 11px; color: #8e8e93;">家庭共创</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="font-size: 18px; font-weight: 700; color: #34d399;">8次</div>
                                <div style="font-size: 11px; color: #8e8e93;">亲子互动</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="font-size: 18px; font-weight: 700; color: #f59e0b;">95%</div>
                                <div style="font-size: 11px; color: #8e8e93;">参与度</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // 家庭共创故事功能
        function openFamilyStories() {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="setLearningGoals()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回目标设置
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">👨‍👩‍👧‍👦 家庭共创故事</h2>
                    </div>
                    
                    <!-- 正在进行的家庭共创 -->
                    <div style="background: linear-gradient(135deg, #34d399 0%, #10b981 100%); color: white; border-radius: 16px; padding: 24px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 16px;">🤝 正在进行的家庭共创</h3>
                        <div style="background: rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">《我们家的超级英雄》</div>
                            <div style="font-size: 12px; opacity: 0.9; margin-bottom: 8px;">
                                爸爸开始：从前有一个普通的家庭，但他们都有秘密的超能力...<br>
                                小明续写：爸爸的超能力是做世界上最好吃的饭菜，妈妈的超能力是给人温暖的拥抱...<br>
                                <span style="color: #fff3cd;">等待妈妈续写 →</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="font-size: 11px;">参与者：👨爸爸 👦小明 👩妈妈</div>
                                <button onclick="continueFamilyStory()" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer;">提醒续写</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 创建新家庭共创 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 16px;">🆕 发起家庭共创</h3>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">共创主题</label>
                            <input type="text" id="familyStoryTitle" placeholder="例如：我们家的奇妙旅行" style="width: 100%; padding: 12px 16px; border: 1px solid #e5e5ea; border-radius: 8px; font-size: 14px; outline: none;">
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">故事开头（家长引导）</label>
                            <textarea id="familyStoryStart" placeholder="写下故事的开头，让孩子接着创作..." style="width: 100%; height: 80px; padding: 12px 16px; border: 1px solid #e5e5ea; border-radius: 8px; font-size: 14px; resize: none; outline: none;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">参与成员</label>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; gap: 4px; background: #f8fafc; padding: 6px 12px; border-radius: 6px;">
                                    <input type="checkbox" checked> 👨 爸爸
                                </label>
                                <label style="display: flex; align-items: center; gap: 4px; background: #f8fafc; padding: 6px 12px; border-radius: 6px;">
                                    <input type="checkbox" checked> 👩 妈妈
                                </label>
                                <label style="display: flex; align-items: center; gap: 4px; background: #f8fafc; padding: 6px 12px; border-radius: 6px;">
                                    <input type="checkbox" checked> 👦 小明
                                </label>
                                <label style="display: flex; align-items: center; gap: 4px; background: #f8fafc; padding: 6px 12px; border-radius: 6px;">
                                    <input type="checkbox"> 👧 姐姐
                                </label>
                            </div>
                        </div>
                        
                        <button onclick="createFamilyStory()" style="background: #34d399; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%;">
                            🚀 创建家庭共创故事
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 家庭任务实现
        function startFamilyTask(taskType) {
            const taskDetails = {
                'story-creation': {
                    name: '家庭故事创作',
                    description: '全家一起编写一个有趣的故事',
                    steps: [
                        '👨 爸爸提供故事主题和背景设定',
                        '👦 小明发挥想象力，添加有趣的角色',
                        '👩 妈妈完善故事情节和细节',
                        '👨‍👩‍👧‍👦 全家一起讨论故事结局'
                    ]
                },
                'math-game': {
                    name: '数学逻辑游戏',
                    description: '通过游戏化方式提升逻辑思维',
                    steps: [
                        '🎯 家长准备简单的逻辑题目',
                        '🎮 孩子尝试解答，家长给予提示',
                        '🏆 正确答案后全家一起庆祝',
                        '📊 总结学习要点和进步'
                    ]
                },
                'science-experiment': {
                    name: '科学小实验',
                    description: '家庭科学探索，培养探究精神',
                    steps: [
                        '🔬 家长介绍实验原理和安全注意事项',
                        '👦 孩子动手操作，观察实验现象',
                        '❓ 一起讨论"为什么会这样"',
                        '📝 记录实验结果和新发现'
                    ]
                }
            };
            
            const task = taskDetails[taskType];
            if (!task) return;
            
            showNotification(`🚀 正在启动${task.name}...`);
            
            setTimeout(() => {
                showFamilyTaskDetail(task);
            }, 1500);
        }
        
        function showFamilyTaskDetail(task) {
            const appContent = document.getElementById('appContent');
            appContent.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 24px;">
                        <button onclick="openFamilyTasks()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer; margin-right: 16px;">
                            <i class="fas fa-arrow-left"></i> 返回任务列表
                        </button>
                        <h2 style="font-size: 20px; font-weight: 700; color: #1d1d1f;">${task.name}</h2>
                    </div>
                    
                    <!-- 任务介绍 -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 20px; margin-bottom: 20px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 12px;">👨‍👩‍👧‍👦</div>
                        <h3 style="margin-bottom: 8px;">${task.name}</h3>
                        <p style="opacity: 0.9; font-size: 14px;">${task.description}</p>
                    </div>
                    
                    <!-- 任务步骤 -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #1d1d1f; margin-bottom: 16px;">📋 任务步骤</h3>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                            ${task.steps.map((step, index) => `
                                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                    <div style="background: #007AFF; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">
                                        ${index + 1}
                                    </div>
                                    <span style="font-size: 14px; color: #374151;">${step}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- 开始任务 -->
                    <div style="display: flex; gap: 12px;">
                        <button onclick="beginFamilyTask()" style="flex: 1; background: #34d399; color: white; border: none; padding: 16px 24px; border-radius: 12px; cursor: pointer; font-weight: 600;">
                            🚀 开始家庭任务
                        </button>
                        <button onclick="scheduleFamilyTask()" style="background: #f59e0b; color: white; border: none; padding: 16px 20px; border-radius: 12px; cursor: pointer; font-weight: 600;">
                            ⏰ 预约时间
                        </button>
                    </div>
                </div>
            `;
        }
        
        function configureTimeLimit() {
            showNotification('⏰ 正在打开时长控制设置...');
            // 这里可以添加时长控制界面
        }
        
        function viewAIInsights() {
            showNotification('🧠 正在生成AI深度分析报告...');
            
            setTimeout(() => {
                showNotification('📈 AI发现：孩子在创造力方面有天赋，建议重点培养');
            }, 2000);
        }
        
        // 家庭任务交互功能
        function beginFamilyTask() {
            showNotification('🚀 家庭任务开始！请全家成员一起参与');
            
            setTimeout(() => {
                showNotification('👨‍👩‍👧‍👦 AI会实时监控家庭互动质量，提供指导建议');
            }, 2000);
            
            setTimeout(() => {
                showNotification('🎉 家庭任务完成！全家获得"家庭协作"成就！');
            }, 4000);
        }
        
        function scheduleFamilyTask() {
            showNotification('⏰ 已设置家庭任务提醒：今晚19:00');
            
            setTimeout(() => {
                showNotification('📱 将在指定时间通知所有家庭成员');
            }, 1500);
        }
        
        function continueFamilyStory() {
            showNotification('✏️ 正在通知妈妈继续创作...');
            
            setTimeout(() => {
                showNotification('📱 已发送提醒到妈妈手机，等待续写');
            }, 1500);
        }
        
        function createFamilyStory() {
            const title = document.getElementById('familyStoryTitle').value.trim();
            const start = document.getElementById('familyStoryStart').value.trim();
            
            if (!title || !start) {
                showNotification('⚠️ 请填写故事标题和开头内容');
                return;
            }
            
            showNotification('🚀 正在创建家庭共创故事...');
            
            setTimeout(() => {
                showNotification('🤖 AI正在分析故事主题，生成续写建议...');
            }, 1500);
            
            setTimeout(() => {
                showNotification('✅ 家庭共创故事创建成功！已通知所有家庭成员');
            }, 3000);
            
            setTimeout(() => {
                showNotification('🎉 获得"家庭创作达人"成就！');
            }, 4500);
        }
        
        // ===== 确保所有首页功能都可用 =====
        
        // 修复首页中可能缺失的函数
        window.addEventListener('load', function() {
            // 确保所有点击事件都有对应的函数
            console.log('✅ 萌芽AI iPad演示已完全加载');
            console.log('✅ 所有功能都已可用：');
            console.log('   - 🌱 虚拟伙伴互动');
            console.log('   - 🎯 能力训练系统');
            console.log('   - 🤖 AI助教对话');
            console.log('   - 📚 故事墙浏览');
            console.log('   - 👤 个人中心查看');
            console.log('   - 📱 Tab页面切换');
            
            // 添加全局错误处理
            window.addEventListener('error', function(event) {
                console.error('发生错误:', event.error);
                showNotification('⚠️ 系统提示：如有问题请刷新页面重试', 'warning');
            });
        });
        
        // 添加点击反馈效果
        document.addEventListener('click', function(event) {
            const clickableElements = [
                '.feature-card', '.tab-item', '.partner-action-btn', 
                '.action-button', '.demo-button', '.achievement-badge'
            ];
            
            for (let selector of clickableElements) {
                if (event.target.closest(selector)) {
                    const element = event.target.closest(selector);
                    element.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        element.style.transform = '';
                    }, 150);
                    break;
                }
            }
        });
    </script>
</body>
</html>
